var Claypool={Logging:{},extend:function(c,b,a){b.apply(c,a||[])}};(function(b,a){a.Logging.NullLogger=function(){var c=function(){return this};b.extend(this,{debug:c,info:c,warn:c,error:c,exception:c});return this};b.extend(a.Logging.NullLogger.prototype,{getLogger:function(){return new a.Logging.NullLogger()}})})(jQuery,Claypool);(function(b,a){a.Configuration={ioc:[],aop:[],logging:[],mvc:{"hijax:a":[],"hijax:form":[],"hijax:button":[],"hijax:event":[]},env:{dev:{},prod:{},test:{}}}})(jQuery,Claypool);(function(b,a){a.CachingStrategy$Interface={cache:null,size:null,clear:function(){throw new a.MethodNotImplementedError()},add:function(d,c){throw new a.MethodNotImplementedError()},remove:function(c){throw new a.MethodNotImplementedError()},find:function(c){throw new a.MethodNotImplementedError()}}})(jQuery,Claypool);(function(b,a){a.SimpleCachingStrategy=function(c){b.extend(true,this,c);this.logger=new a.Logging.NullLogger();this.clear();return this};b.extend(a.SimpleCachingStrategy.prototype,a.CachingStrategy$Interface,{clear:function(){this.logger.debug("Clearing Cache.");this.cache=null;this.cache={};this.size=0},add:function(d,c){this.logger.debug("Adding To Cache: %s",d);if(!this.cache[d]){this.cache[d]=c;this.size++;return d}return null},remove:function(c){this.logger.debug("Removing From Cache id: %s",c);if(this.find(c)){return(delete this.cache[c])?--this.size:-1}return null},find:function(c){this.logger.debug("Searching Cache for id: %s",c);return this.cache[c]||null}})})(jQuery,Claypool);(function(b,a){a.Context=function(c){a.extend(this,a.SimpleCachingStrategy);b.extend(true,this,c);this.logger=new a.Logging.NullLogger()};b.extend(a.Context.prototype,a.SimpleCachingStrategy.prototype,{get:function(c){throw new a.MethodNotImplementedError()},put:function(d,c){throw new a.MethodNotImplementedError()}})})(jQuery,Claypool);(function(b,a){a.ContextContributor=function(c){a.extend(this,a.Context);b.extend(true,this,c);this.logger=b.logger("Claypool.ContextContributor")};b.extend(a.ContextContributor.prototype,a.Context.prototype,{registerContext:function(c){throw new a.MethodNotImplementedError()}})})(jQuery,Claypool);(function(b,a){a.Router=function(c){a.extend(this,a.SimpleCachingStrategy);b.extend(true,this,c);this.logger=a.Logging.getLogger("Claypool.Router")};b.extend(a.Router.prototype,a.SimpleCachingStrategy.prototype,{compile:function(g,d){this.logger.debug("compiling patterns for match strategies");var f,k,h;var e,c;d=d.split("|");for(e=0;e<g.length;e++){for(c=0;c<d.length;c++){f=g[e][d[c]];h=[];if(f){this.logger.debug("Compiling \n\tpattern: %s for \n\ttarget.",f);f=f.replace(/\<\:(.+?)\:\>/g,function(){var j,l=arguments[0].indexOf("(");j=arguments[0].substring(2,l);h.push(j);return arguments[0].substring(l,arguments[0].length-2)});f=f.replace(/\|\:\w+\|/g,function(){var i;i=arguments[0].substring(2,arguments[0].length-1);h.push(i);return"(\\w+)"});this.add(String(b.guid()),{pattern:new RegExp(f),payload:g[e],params:h})}}}return this},first:function(d){this.logger.debug("Using strategy 'first'");var c,f,e={};for(f in this.cache){c=this.find(f);this.logger.debug("checking pattern %s for string %s",c.pattern,d);if(c&&c.pattern&&c.pattern.test&&c.pattern.test(d)){this.logger.debug("found match for \n\tpattern: %s \n\ttarget : %s ",c.pattern,c.payload.controller||c.payload.rewrite);if(c.params&&c.params.length>0){d.replace(c.pattern,function(){var g;for(g=1;g<arguments.length-2;g++){e[c.params[g-1]]=arguments[g]}})}return[b.extend({map:e},c)]}}this.logger.debug("found no match for \n\tpattern: %s",d);return[]},all:function(d){this.logger.debug("Using strategy 'all'");var e=[];var c,g,f={};for(g in this.cache){c=this.find(g);this.logger.debug("checking pattern: %s for string %s",c.pattern,d);if(c&&c.pattern&&c.pattern.test&&c.pattern.test(d)){this.logger.debug("found match for \n\tpattern: %s \n\ttarget : %s ",c.pattern,c.payload.controller);if(c.params&&c.params.length>0){d.replace(c.pattern,function(){var h;for(h=1;h<arguments.length-2;h++){f[c.params[h-1]]=arguments[h]}})}e.push(b.extend({map:f},c))}}if(e.length===0){this.logger.debug("found no match for \n\tpattern: %s",d)}return e}})})(jQuery,Claypool);(function(b,a){a.Factory$Interface={create:function(){throw new a.MethodNotImplementedError()}}})(jQuery,Claypool);(function(b,a){a.Configurable$Interface={configurationId:null,configuration:null,configurationUrl:null,configurationType:null,getConfig:function(){throw new a.MethodNotImplementedError()},loadConfig:function(){throw new a.MethodNotImplementedError()},setConfig:function(){throw new a.MethodNotImplementedError()},updateConfig:function(){throw new a.MethodNotImplementedError()}}})(jQuery,Claypool);(function(b,a){a.Scanner$Interface={scan:function(){throw new a.MethodNotImplementedError()}}})(jQuery,Claypool);(function(b,a){a.BaseFactory=function(c){a.extend(this,a.SimpleCachingStrategy);b.extend(true,this,{configurationUrl:"./app/configs/config.js",configurationType:"json"},c);this.logger=new a.Logging.NullLogger();return this};b.extend(a.BaseFactory.prototype,a.SimpleCachingStrategy.prototype,a.Factory$Interface,a.Configurable$Interface,a.Scanner$Interface,{getConfig:function(){if(!this.configuration){this.logger.warn("Configuration for <%s> has not been set explicitly or has been updated implicitly.",this.configurationId);try{this.logger.debug("$$.Configuration: \n %o",a.Configuration);if(a.Configuration[this.configurationId]){this.logger.info("Found Claypool.Configuration");this.configuration=a.Configuration[this.configurationId]}else{if(!a.Configuration){this.loadConfig()}}}catch(c){this.logger.exception(c);throw new a.ConfigurationError(c)}}return this.configuration},loadConfig:function(c){c=c||{};this.configurationUrl=c.url||this.configurationUrl;this.logger.info("Attempting to load configuration from: %s",this.configurationUrl);var f=this;try{jQuery.ajax({type:"Get",url:this.configurationUrl,async:false,data:{},dataType:"json",success:function(e){if(f.configurationUrl=="./app/configs/config.js"){a.Configuration=a.Configuration||{};b.extend(true,a.Configuration,e)}else{f.setConfig(f.configurationId,e?e:null)}if(c.callback){c.callback(a.Configuration)}}})}catch(d){this.logger.exception(d);throw new a.ConfigurationError(d)}},setConfig:function(d,c){this.logger.info("Setting configuration");this.configuration=c;a.Configuration[d]=c},updateConfig:function(c){throw new a.MethodNotImplementedError()}})})(jQuery,Claypool);(function(b,a){a.Error=function(d,c){b.extend(true,this,d||new Error());this.name=(c&&c.name?c.name:"Claypool.UnknownError")+" > Claypool.Error"+(this.name?(" > "+this.name):"");this.message=(c&&c.name?c.name:"No Message Provided \n Nested exception is:\n\t")+(this.message||"UnknownError")}})(jQuery,Claypool);(function(b,a){a.ConfigurationError=function(f,c){var d={name:"Claypool.ConfigurationError",message:"An error occured trying to locate or load the system configuration."};b.extend(this,new a.Error(f,c?{name:(c.name?(c.name+" > "):"")+d.name,message:(c.message?(c.message+" \n "):"")+d.message}:d))}})(jQuery,Claypool);(function(b,a){a.MethodNotImplementedError=function(f,c){var d={name:"Claypool.MethodNotImplementedError",message:"Method not implemented."};b.extend(this,new a.Error(f,c?{name:(c.name?(c.name+" > "):"")+d.name,message:(c.message?(c.message+" \n "):"")+d.message}:d))}})(jQuery,Claypool);(function(b,a){a.NameResolutionError=function(f,c){var d={name:"Claypool.NameResolutionError",message:"Unexpected error resolving name."};b.extend(this,new a.Error(f,c?{name:(c.name?(c.name+" > "):"")+d.name,message:(c.message?(c.message+" \n "):"")+d.message}:d))}})(jQuery,Claypool);(function(f,b){var e=[],c=0,a={},d;f.extend(a,{$:function(k,j){var g,h;if(j===undefined){g=null;for(h=0;h<e.length;h++){g=e[h]().get(k);if(g){return g}}return null}else{if(e[0]().find(k)){e[0]().remove(k)}e[0]().put(k,j)}},register:function(h,g){if(Math.abs(g)>(e.length-1)/2){if(g===0&&f.isFunction(h.getContext)){e[0]=h.getContext
}else{if(g!==0){if(f.isFunction(h.getContext)){e.push(h.getContext)}if(f.isFunction(h.getCachedContext)){e.unshift(h.getCachedContext)}}}}},guid:function(){return(++c)+"_"+new Date().getTime()+"_"+Math.round(Math.random()*100000000)},resolve:function(g){var m;var j;var l;var h;try{m=function(i){return this[i]};j=g.split(".");l=null;for(h=0;h<j.length;h++){l=m.call(l,j[h]);if(l===undefined){return l}}return l}catch(k){throw new b.NameResolutionError(k)}},config:function(){var g,h;if(arguments.length===0){return b.Configuration}else{if(arguments.length===1&&typeof(arguments[0])=="string"){return f.resolve("Claypool.Configuration."+arguments[0])}else{g=f.resolve("Claypool.Configuration."+arguments[0]);if(g){h=arguments[1];if(h instanceof Array){g=f.merge(g,h)}else{if(h instanceof Object){g=f.extend(true,g,h)}}}}}return this},env:function(){if(arguments.length==2){d=f.extend(true,d||{},f.config("env."+arguments[0]),f.config("env."+arguments[1]));return d}else{if(arguments.length===1&&!(typeof(arguments[0])=="string")){return f.config("env",arguments[0])}return d[arguments[0]]||null}}});f.extend(b,a);f.extend(f,a)})(jQuery,Claypool);Claypool.Application={};(function(d,b,c){var a=0;c.context=null;d.extend(c,{getContext:function(){if(!c.context){c.context=new c.Context()}return c.context},Initialize:function(e){d(document).trigger("claypool:initialize",[c]);if(e){e()}d(document).trigger("ApplicationLoaded");return c.getContext()},Reinitialize:function(e){d(document).trigger("claypool:reinitialize",[c]);if(e){e()}d(document).trigger("ApplicationReloaded");return c.getContext()}});d.register(c,a)})(jQuery,Claypool,Claypool.Application);(function(c,a,b){b.Context=function(d){a.extend(this,a.Context);this.contextContributors={};c.extend(true,this,d);this.logger=c.logger("Claypool.Application.Context")};c.extend(b.Context.prototype,a.Context.prototype,{get:function(h){var f;var d;try{this.logger.debug("Searching application context for object: %s",h);f=null;f=this.find(h);if(f!==null){this.logger.debug("Found object in global application context. Object id: %s",h);return f}else{this.logger.debug("Searching for object in contributed application context. Object id: %s",h);for(d in this.contextContributors){this.logger.debug("Checking Application Context Contributor %s.",d);f=this.contextContributors[d].get(h);if(f!==null){this.logger.debug("Found object in contributed application context. Object id: %s",h);return f}}}this.logger.debug("Cannot find object in any application context. Object id: %s",h);return null}catch(g){throw new b.ContextError(g)}},put:function(e,d){this.logger.debug("Adding object to global application context %s",e);this.add(e,d)}})})(jQuery,Claypool,Claypool.Application);(function(c,a,b){b.ContextContributor=function(d){a.extend(this,a.ContextContributor);c.extend(true,this,d);this.logger=c.logger("Claypool.Application.ContextContributor");return this};c.extend(b.ContextContributor.prototype,a.ContextContributor.prototype,{registerContext:function(d){this.logger.info("Registering Context id: %s",d);b.getContext().contextContributors[d]=this}})})(jQuery,Claypool,Claypool.Application);(function(c,a,b){b.Aware=function(d){c.extend(this,d);this.logger=c.logger("Claypool.Application.Aware")};c.extend(b.Aware.prototype,{$:function(){return b.getContext()}})})(jQuery,Claypool,Claypool.Application);(function(c,a,b){b.ContextError=function(g,d){var f={name:"Claypool.Application.ContextError",message:"An unexpected error occured while searching the application context."};c.extend(this,new a.Error(g,d?{name:(d.name?(d.name+" > "):"")+f.name,message:(d.message?(d.message+" \n "):"")+f.message}:f))}})(jQuery,Claypool,Claypool.Application);(function(c,a,b){c.extend(c,{app:function(){return b.getContext()},boot:function(d){b.Initialize(d);return this},reboot:function(d){b.Reinitialize(d);return this},manage:function(d,e){c(document).bind("claypool:initialize",function(g,f){f.managedId=new (c.resolve(d))();if(f.ContextContributor&&c.isFunction(f.ContextContributor)){f.managedId.registerContext(d)}}).bind("claypool:reinitialize",function(g,f){f.managedId.factory.updateConfig()});return this}})})(jQuery,Claypool,Claypool.Application);Claypool.AOP={};(function(c,b,a){c.manage("Claypool.AOP.Container","claypool:AOP")})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.Aspect=function(d){this.id=null;this.type=null;b.extend(this,b.SimpleCachingStrategy);c.extend(true,this,d);this.logger=c.logger("Claypool.AOP.Aspect");this.strategy=this.strategy||"all"};c.extend(a.Aspect.prototype,b.SimpleCachingStrategy.prototype,{weave:function(){var i=this;var g;var d;if(!this.target){i.logger.warn("No pointcut was specified.  Cant weave aspect.");return}var h=function(f){var k,j;try{i.logger.info("Weaving Advice %s for Aspect %s",f,i.id);i.hasPrototype=typeof(i.target.prototype)!="undefined";j=i.hasPrototype?i.target.prototype[f]:i.target[f];k=i.advise(j);if(!i.hasPrototype){i.target[f]=k}else{i.target.prototype[f]=k}return{pointcut:k,cutline:j}}catch(l){throw new a.WeaveError(l,"Weave")}};if(this.size===0){g=new RegExp(this[this.type?this.type:"method"]);d=this.target.prototype?this.target.prototype:this.target;for(var e in d){if(c.isFunction(d[e])&&g.test(e)){this.logger.debug("Adding aspect to method %s",e);this.add(c.guid(),h(e));if(this.strategy==="first"){break}}}}return this},unweave:function(){var d;try{for(var g in this.cache){d=this.find(g);if(!this.hasPrototype){this.target[this.method]=d.cutline}else{this.target.prototype[this.method]=d.cutline}this.hasPrototype=null}this.clear()}catch(f){throw new a.WeaveError(f,"Unweave")}return true},advise:function(d){throw new b.MethodNotImplementedError()}})})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.After=function(d){b.extend(this,a.Aspect);c.extend(true,this,d);this.logger=c.logger("Claypool.AOP.After");this.type="after"};c.extend(a.After.prototype,a.Aspect.prototype,{advise:function(d){var g=this;try{return function(){var e=d.apply(this,arguments);return g.advice.apply(g,[e])}}catch(f){throw new a.AspectError(f,"After")}}})})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.Before=function(d){b.extend(this,a.Aspect);c.extend(true,this,d);this.logger=c.logger("Claypool.AOP.Before");this.type="before"};c.extend(a.Before.prototype,a.Aspect.prototype,{advise:function(d){var g=this;try{return function(){g.advice.apply(g,arguments);return d.apply(this,arguments)}}catch(f){throw new a.AspectError(f,"Before")}}})})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.Around=function(d){b.extend(this,a.Aspect);c.extend(true,this,d);this.logger=c.logger("Claypool.AOP.Around");this.type="around"};c.extend(a.Around.prototype,a.Aspect.prototype,{advise:function(d){var g=this;try{return function(){var e={object:this,args:arguments};return g.advice.apply(g,[{arguments:e.args,proceed:function(){var h=d.apply(e.object,e.args);return h}}])}}catch(f){throw new a.AspectError(f,"Around")}}})})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.Factory=function(d){b.extend(this,b.BaseFactory);c.extend(true,this,d);this.configurationId="aop";this.aspectCache=null;this.logger=c.logger("Claypool.AOP.Factory");this.aspectCache=new b.SimpleCachingStrategy()};c.extend(a.Factory.prototype,b.BaseFactory.prototype,{updateConfig:function(){var l=this;var f;var k;var j;var h,g,d,n;try{this.logger.debug("Configuring Claypool AOP AspectFactory");f=this.getConfig()||[];this.logger.debug("AOP Configurations: %d",f.length);for(j=0;j<f.length;j++){try{k=f[j];if(!c.isFunction(k.advice)){k.advice=c.resolve(k.advice)}if(k.target.match("^ref://")){h=k.target.substr(6,k.target.length);c(document).bind("claypool:ioc:"+h,function(p,q,o){l.logger.debug("Creating aspect id %s for instance %s",k.id);var e=o.find(q);k.target=e._this;l.add(k.id,k);var i=l.create(k.id);e._this=i.target;o.remove(q);o.add(q,e);l.logger.debug("Created aspect \n%s, \n%s")}).bind("claypool:predestroy:"+h,function(o,e){l.logger.debug("Destroying aspect id %s for instance %s",k.id);var i=l.aspectCache.find(k.id);
if(i&&i.unweave){i.unweave()}})}else{if(k.target.match(/\.\*^/)){g=c.resolve(k.target.substring(0,k.target.length-2));for(d in g){if(c.isFunction(g[d])){n=c.extend({id:k.id+c.createGUID(),target:g[d]},k);this.logger.debug("Creating aspect id %s",n.id);this.add(n.id);this.create(n.id)}}}else{this.logger.debug("Creating aspect id %s",k.id);k.target=c.resolve(k.target);this.add(k.id,k);this.create(k.id)}}}catch(m){this.logger.exception(m)}}}catch(m){this.logger.exception(m);throw new a.ConfigurationError(m)}return true},create:function(k){var j;var d;var f=this.aspectCache.find(k);var i=this;var g=function(l){var e=null;if(l.after){e=new a.After(l)}else{if(l.before){e=new a.Before(l)}else{if(l.around){e=new a.Around(l)}}}return e.weave()};if(f){return f}else{try{this.logger.debug("Looking for configuration for aspect %s",k);j=this.find(k);if(j===undefined||j===null){this.logger.debug("%s is not an Aspect.",k);return null}else{this.logger.debug("Found configuration for instance %s",k);if(j.selector){this.logger.debug("Attaching contructor to an active selector");i=this;d=function(){f=g(j);i.aspectCache.add(j.id+"#"+this.toString(),f);return f};if(j.active){c(j.selector).livequery(d)}else{c(j.selector).each(d)}}else{f=g(j);this.aspectCache.add(k,f)}return f}}catch(h){this.logger.exception(h);throw new a.FactoryError(h)}}}})})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.Container=function(d){b.extend(this,b.Application.ContextContributor);c.extend(true,this,d);this.factory=null;this.logger=c.logger("Claypool.AOP.Container");this.logger.debug("Configuring Claypool AOP Container");this.factory=new a.Factory(d);this.factory.updateConfig()};c.extend(a.Container.prototype,b.Application.ContextContributor.prototype,{get:function(g){var d;try{this.logger.debug("Search for a container managed aspect :%s",g);d=this.find(g);if(d===undefined||d===null){this.logger.debug("Can't find a container managed aspect :%s",g);d=this.factory.create(g);if(d!==null){this.add(g,d);return d}}else{this.logger.debug("Found container managed instance :%s",g);return d}}catch(f){this.logger.exception(f);throw new a.ContainerError(f)}return null}})})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.ContainerError=function(g,d){var f={name:"Claypool.AOP.ContainerError",message:"An error occured inside the aop container."};c.extend(this,new b.Error(g,d?{name:(d.name?(d.name+" > "):"")+f.name,message:(d.message?(d.message+" \n "):"")+f.message}:f))}})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.ConfigurationError=function(g,d){var f={name:"Claypool.AOP.ConfigurationError",message:"An error occured updating the aop container configuration."};c.extend(this,new b.ConfigurationError(g,d?{name:(d.name?(d.name+" > "):"")+f.name,message:(d.message?(d.message+" \n "):"")+f.message}:f))}})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.FactoryError=function(g,d){var f={name:"Claypool.AOP.FactoryError",message:"An error occured creating the aspect from the configuration."};c.extend(this,new b.Error(g,d?{name:(d.name?(d.name+" > "):"")+f.name,message:(d.message?(d.message+" \n "):"")+f.message}:f))}})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.WeaveError=function(g,d){var f={name:"Claypool.AOP.WeaveError",message:"An error occured weaving or unweaving the aspect."};c.extend(this,new b.Error(g,d?{name:(d.name?(d.name+" > "):"")+f.name,message:(d.message?(d.message+" \n "):"")+f.message}:f))}})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.AspectError=function(g,d){var f={name:"Claypool.AOP.AspectError",message:"An error occured while applying an aspect."};c.extend(this,new b.Error(g,d?{name:(d.name?(d.name+" > "):"")+f.name,message:(d.message?(d.message+" \n "):"")+f.message}:f))}})(jQuery,Claypool,Claypool.AOP);(function(c,a,b){c.extend(c,{filters:function(){if(arguments.length===0){return c.config("aop")}else{return c.config("aop",arguments[0])}}})})(jQuery,Claypool,Claypool.AOP);Claypool.IoC={};(function(c,a,b){c.manage("Claypool.IoC.Container","claypool:IoC")})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.Instance=function(e,d){c.extend(this,{_this:null,id:null,configuration:null,guid:c.guid(),type:null,id:e,configuration:d||{},logger:c.logger("Claypool.IoC.Instance")});this.logger.category=this.logger.category+"."+this.id};c.extend(b.Instance.prototype,{precreate:function(){try{this._this={claypoolId:this.id};this.logger.debug("Precreating Instance");c(document).trigger("claypool:precreate",[this._this,this.id]);c(document).trigger("claypool:precreate:"+this.id,[this._this]);return this}catch(d){this.logger.error("An Error occured in the Pre-Create LifeCycle Phase");this.logger.exception(d);throw new b.LifeCycleError(d)}},create:function(){var i,p,f,g;var l,o,k,n;var d,j;try{this.logger.debug("Applying Selector to Instance");if(this.configuration.selector){this._this=c(this.configuration.selector);this.logger.debug("Result for selector : ",this._this)}else{this.logger.debug("Using default empty object");this._this={}}if(this.configuration.factory){i={};if(this.configuration.factory.substring(6,0)=="ref://"){this.logger.debug("Retreiving Factory from Application Context");i=c.$(this.configuration.factory)}else{this.logger.info("Creating Instance from Factory");p=this.resolveConstructor(this.configuration.factory);retval=p.apply(i,this.configuration.options);i=retval||i}this.logger.debug("Applying factory creation method");f=this.configuration.factoryMethod||"create";l=i[f].apply(i,this.configuration.options);this._this=c.extend(true,l,this._this)}else{this.logger.info("Creating Instance simulating constructor: %s",this.configuration.clazz);k=this.resolveConstructor(this.configuration.clazz);n=this.configuration.options||[];l={};switch(n.length){case 0:l=new k();break;case 1:l=new k(n[0]);break;case 2:l=new k(n[0],n[1]);break;case 3:l=new k(n[0],n[1],n[2]);break;case 4:l=new k(n[0],n[1],n[2],n[3]);break;case 5:l=new k(n[0],n[1],n[2],n[3],n[4]);break;case 6:l=new k(n[0],n[1],n[2],n[3],n[4],n[5]);break;case 7:l=new k(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);break;case 8:l=new k(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);break;case 9:l=new k(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8]);break;default:o=k.apply(l,n);l=o||l}l.$ns=this.configuration.clazz;l.$log=c.logger(l.$ns);l.$log.info("Created new instance of %s",l.$ns);this._this=c.extend(true,l,this._this)}d=this.configuration.inject||{};for(var h in d){j=d[h];if(c.isFunction(j.substring)&&(j.substring(0,6)=="ref://")){d[h]=c.$(j.substring(6,j.length))}}c.extend(this._this,d);c(document).trigger("claypool:create",[this._this,this.id]);c(document).trigger("claypool:create:"+this.id,[this._this]);return this._this}catch(m){this.logger.error("An Error occured in the Create LifeCycle Phase");this.logger.exception(m);throw new b.LifeCycleError(m)}},postcreate:function(){try{this.logger.debug("PostCreate invoked");c(document).trigger("claypool:postcreate",[this._this,this.id]);c(document).trigger("claypool:postcreate:"+this.id,[this._this]);return this._this}catch(d){this.logger.error("An Error occured in the Post-Create LifeCycle Phase");this.logger.exception(d);throw new b.LifeCycleError(d)}},predestroy:function(){try{this.logger.debug("Predestory invoked");c(document).trigger("claypool:predestroy",[this._this,this.id]);c(document).trigger("claypool:predestroy:"+this.id,[this._this]);return this._this}catch(d){this.logger.exception(d);throw new b.LifeCycleError(d)}},destroy:function(){try{this.logger.info("Destroy invoked");c(document).trigger("claypool:destroy",[this._this,this.id]);c(document).trigger("claypool:destroy:"+this.id,[this._this]);return delete this._this}catch(d){this.logger.exception(d);throw new b.LifeCycleError(d)}},postdestroy:function(){try{this.logger.debug("Postdestory invoked");c(document).trigger("claypool:postdestroy",[this.id]);c(document).trigger("claypool:postdestroy:"+this.id);return this}catch(d){this.logger.exception(d);throw new b.LifeCycleError(d)}},resolveConstructor:function(d){var f;try{f=c.resolve(d);
if(c.isFunction(f)){this.logger.debug(" Resolved "+d+" to a function");return f}else{throw new Error("Constructor is not a function: "+d)}}catch(g){this.logger.exception(g);throw new b.ConstructorResolutionError(g)}}})})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.Factory=function(d){a.extend(this,a.BaseFactory);c.extend(true,this,d);this.configurationId="ioc";this.logger=c.logger("Claypool.IoC.Factory")};c.extend(b.Factory.prototype,a.BaseFactory.prototype,{createLifeCycle:function(d){try{d.precreate();d.create();d.postcreate()}catch(f){this.logger.error("An Error occured in the Creation Lifecycle.");this.logger.exception(f);throw new b.LifeCycleError(f)}},destroyLifeCycle:function(d){try{d.predestroy();d.destroy();d.postdestroy()}catch(f){this.logger.error("An Error occured in the Destory Lifecycle.");this.logger.exception(f);throw new b.LifeCycleError(f)}},create:function(i){var h;var d;var g=this;try{this.logger.debug("Looking for configuration for instance %s",i);h=this.find(i);if(h===null){this.logger.warn("No known configuration for instance %s",i);return null}else{this.logger.debug("Found configuration for instance %s",i);d=new b.Instance(h.id,h);if(h.active&&h.selector){this.logger.debug("Attaching contructor to an active selector");d.precreate();d._this["@claypool:activeobject"]=h.selector;d._this["@claypool:id"]=d.id;jQuery(h.selector).livequery(function(){g.logger.debug("Processing Creation Lifecycle.");g.createLifeCycle(d)},function(){g.logger.debug("Processing Destruction Lifecycle.");g.destroyLifeCycle(d)})}else{this.logger.debug("Processing Creation Lifecycle.");this.createLifeCycle(d)}return d}}catch(f){this.logger.exception(f);throw new b.FactoryError(f)}},updateConfig:function(){var h;var d;var f;try{this.logger.debug("Configuring Claypool IoC Factory");h=this.getConfig()||[];this.logger.debug("IoC Configurations: %d",h.length);for(f=0;f<h.length;f++){try{d=h[f];if(d.scan&&d.factory){this.logger.debug("Scanning %s with %s",d.scan,d.factory);h=h.concat(d.factory.scan(d.scan))}else{this.logger.debug("IoC Configuration for Id: %s",d.id);this.add(d.id,d)}}catch(g){this.logger.exception(g);return false}}}catch(g){this.logger.exception(g);throw new b.ConfigurationError(g)}return true}})})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.Container=function(d){a.extend(this,a.Application.ContextContributor);c.extend(true,this,d);this.factory=null;this.logger=c.logger("Claypool.IoC.Container");this.logger.debug("Configuring Claypool IoC Container");this.factory=new b.Factory();this.factory.updateConfig()};c.extend(b.Container.prototype,a.Application.ContextContributor.prototype,{get:function(h){var d;var g=this;try{this.logger.debug("Search for a container managed instance :%s",h);d=this.find(h);if(!d){this.logger.debug("Can't find a container managed instance :%s",h);d=this.factory.create(h);if(d){this.logger.debug("Storing managed instance %s in container",h);this.add(h,d);if(d._this["@claypool:activeobject"]){c(document).bind("claypool:postcreate:"+d.id,function(i,e,j){g.logger.info("Reattached Active Object Inside IoC Container");d._this=e});c(document).bind("claypool:postdestroy:"+d.id,function(){g.logger.info("Removed Active Object Inside IoC Container");g.remove(h)})}else{c(document).trigger("claypool:ioc",[h,this]);c(document).trigger("claypool:ioc:"+h,[h,this])}return this.find(h)._this}}else{this.logger.debug("Found container managed instance :%s",h);return d._this}}catch(f){this.logger.exception(f);throw new b.ContainerError(f)}return null}})})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.ContainerError=function(d){c.extend(this,new a.Error(d,{name:"Claypool.IoC.ContainerError",message:"An error occured in the ioc instance factory."}))}})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.FactoryError=function(d){c.extend(this,new a.Error(d,{name:"Claypool.IoC.FactoryError",message:"An error occured in the ioc factory."}))}})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.ConfigurationError=function(d){c.extend(this,new a.ConfigurationError(d,{name:"Claypool.IoC.ConfigurationError",message:"An error occured updating the ioc container configuration."}))}})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.LifeCycleError=function(d){c.extend(this,new a.Error(d,{name:"Claypool.IoC.LifeCycleError",message:"An error occured during the lifecycle process."}))}})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.ConstructorResolutionError=function(d){c.extend(this,new a.NameResolutionError(d,{name:"Claypool.IoC.ConstructorResolutionError",message:"An error occured trying to resolve the constructor."}))}})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){c.extend(c,{scan:function(){var d,e;if(arguments.length===0){return c.config("ioc")}else{d=[];for(e=0;e<arguments[0].length;e++){d.push({scan:arguments[0][e],factory:a.MVC.Factory.prototype})}return c.config("ioc",d)}},invert:function(){if(arguments.length===0){return c.config("ioc")}else{return c.config("ioc",arguments[0])}}})})(jQuery,Claypool,Claypool.IoC);Claypool.MVC={};(function(a){a.manage("Claypool.MVC.Container","claypool:MVC")})(jQuery);(function(c,a,b){b.View$Interface={update:function(d){throw new a.MethodNotImplementedError()},think:function(){throw new a.MethodNotImplementedError()}}})(jQuery,Claypool,Claypool.MVC);(function(c,a,b){b.Controller=function(d){this.model=null;this.view=null;a.extend(this,a.SimpleCachingStrategy);c.extend(true,this,d);this.logger=c.logger("Claypool.MVC.Controller")};c.extend(b.Controller.prototype,a.SimpleCachingStrategy.prototype,{handle:function(d){throw new a.MethodNotImplementedError()}})})(jQuery,Claypool,Claypool.MVC);(function(c,a,b){b.HijaxController=function(d){a.extend(this,b.Controller);c.extend(true,this,{forwardingList:[],selector:"",filter:"",active:true,preventDefault:true,stopPropagation:true,hijaxMap:[],resolveQueue:[],strategy:null},d);this.router=new a.Router();this.bindCache=new a.SimpleCachingStrategy();this.logger=c.logger("Claypool.MVC.HijaxController")};c.extend(b.HijaxController.prototype,b.Controller.prototype,{handle:function(d){this.logger.debug("Handling pattern: %s",d.pattern);this.forwardingList=this.router[this.strategy||"all"](d.pattern);this.logger.debug("Resolving matched paterns");var e=this;return jQuery(this.forwardingList).each(function(){var i,g,f;try{e.logger.info("Forwaring to registered controller %s",this.payload.controller);i=c.$(this.payload.controller);f=this.payload.controller.match("Controller")?this.payload.controller.replace("Controller","View"):null;f=this.payload.controller.match("Service")?this.payload.controller.replace("Service","View"):f;(function(q){var l=d.args[0],k=[],j={flash:[],length:0},n=f,r=i;for(var p=1;p<d.args.length;p++){k[p-1]=d.args[p]}var o=c.extend({},l,{m:function(){if(arguments.length===0){return j}else{if(arguments.length===1){if(typeof(arguments[0])=="string"){return j[arguments[0]]}else{if(arguments[0] instanceof Array){j.length+=arguments[0].length;Array.prototype.push.apply(j,arguments[0])}else{if(arguments[0] instanceof Object){c.extend(true,j,arguments[0])}}}}else{if(arguments.length===2){if(arguments[1] instanceof Array){if(typeof(arguments[0])=="string"&&!(arguments[0] in j)){j[arguments[0]]=[]}c.merge(j[arguments[0]],arguments[1])}else{if(arguments[1] instanceof XML||arguments[1] instanceof XMLList){j[arguments[0]]=arguments[1]}else{if(arguments[1] instanceof Object){if(typeof(arguments[0])=="string"&&!(arguments[0] in j)){j[arguments[0]]={}}c.extend(true,j[arguments[0]],arguments[1])}}}}}}return this},v:function(m){if(!m){return n}if(m&&typeof(m)=="string"){m=m.split(".");if(m.length===1){n=m}else{if(m.length===2){if(m[0]!==""){n=m.join(".")}else{n=n.split(".")[0]+"."+m[1]}}}}return this},c:function(){var t,s,m;if(arguments.length===0){return r}else{if(arguments.length>0&&typeof(arguments[0]=="string")){t=arguments[0].split(".");r=t[0];n=r.match("Controller")?r.replace("Controller","View"):null;n=r.match("Service")?r.replace("Service","View"):n;s=(t.length>1&&t[1].length>0)?t[1]:"handle";
m=e.find(t[0]);if(m===null){m=c.$(t[0]);e.add(t[0],m)}m[s||"handle"].apply(m,[this].concat(k))}}return this},render:e.renderer(),reset:function(){j={flash:[],length:0};n=f;r=i;return this},params:function(m){if(arguments.length===0){return q.map?q.map:{}}else{return q.map&&q.map[m]?q.map[m]:null}}});i[q.payload.action||"handle"].apply(i,[o].concat(k))})(this)}catch(h){h=h?h:new Error();if(h.name&&h.name.indexOf("Claypool.Application.ContextError")>-1){e.logger.warn("No controller with id: %s",this.payload.controller)}else{e.logger.exception(h);throw h}}})},attach:function(){this.router.compile(this.hijaxMap,this.routerKeys);var d=this;if(this.active&&(this.selector!==""||this.filter!=="")){this.logger.debug("Actively Hijaxing %s's %s%s",this.hijaxKey,this.selector,this.filter);c(this.selector+this.filter).livequery(function(){d.hijax(this)})}else{if(this.selector!==""||this.filter!==""){this.logger.debug("Hijaxing Current %s's.",this.hijaxKey);c(this.selector+this.filter).each(function(){d.hijax(this)})}else{if(document!==undefined){this.logger.debug("Hijaxing Document For %s's.",this.hijaxKey);d.hijax(document)}else{this.logger.warn("Unable to attach controller: %s",options.id)}}}},hijax:function(e){this.logger.debug("Hijaxing %s: %s",this.hijaxKey,e);var f=this;var d=function(g){var h=true;f.logger.info("Hijaxing %s: ",f.hijaxKey);if(f.stopPropagation){f.logger.debug("Stopping propogation of event");g.stopPropagation()}if(f.preventDefault){f.logger.debug("Preventing default event behaviour");g.preventDefault();h=false}f.handle({pattern:f.target.apply(f,arguments),args:arguments});return h};if(this.event){c(this.event.split("|")).each(function(){c(e).bind(this+"."+f.eventNamespace,d);f.logger.debug("Binding event %s to hijax controller on target",this,e)})}else{c(this.hijaxMap).each(function(){if(this.event&&!f.bindCache.find(this.event)){f.bindCache.add(this.event,f);f.logger.debug("Binding event %s to controller %s on target %s",this.event,this.controller,e);c(e).bind(this.event+"."+f.eventNamespace,d)}})}return true},renderer:function(){var e=this;var d=[];return function(m){var l,g,j,f,h,i;if(m&&c.isFunction(m)){d.push(m)}e.logger.debug(" - Resolving Control - %s)",this.c());try{f=this.v();h=c.isFunction(this.write)?"render":"update";if(f.indexOf(".")>-1){h=f.split(".");f=h[0];h=h[h.length-1]}e.logger.debug("Calling View %s.%s",f,h);f=c.$(f);if(f){if(c.isFunction(f[h])){if(this.write){f.write=this.write;f.append=this.append;f[h](this.m())}else{f[h](this.m())}e.logger.debug("Cascading callbacks");while(d.length>0){(d.pop())()}}else{if(f["@claypool:activeobject"]){i="claypool:postcreate:"+f["@claypool:id"]+"."+c.guid();c(document).bind(i,function(n,o){e.logger.warn("The view is reattached to the dom.");c(document).unbind(i);o.update(this.m());e.logger.debug("Cascading callbacks");while(d.length>0){(d.pop())()}})}else{e.logger.debug("View method cannot be resolve",h)}}}else{e.logger.warn("Cant resolve view %s. ",this.v())}}catch(k){e.logger.error("Error resolving flow %s => %s",this.c(),this.v()).exception(k);throw k}return this}},target:function(d){throw new a.MethodNotImplementedError()}})})(jQuery,Claypool,Claypool.MVC);(function(c,a,b){b.Factory=function(d){a.extend(this,a.IoC.Factory);c.extend(true,this,d);this.configurationId="mvc";this.logger=c.logger("Claypool.MVC.Factory")};c.extend(b.Factory.prototype,a.IoC.Factory.prototype,{updateConfig:function(){var d;try{this.logger.debug("Configuring Claypool MVC Controller Factory");d=this.getConfig()||{};c(document).trigger("claypool:hijax",[this,this.initializeHijaxController,d])}catch(f){this.logger.exception(f);throw new b.ConfigurationError(f)}},scan:function(h){var j=this.logger||c.logger("Claypool.MVC.Factory");j.debug("Scanning %s",h);var l,g,i=[],f=function(e,m){return("#"+e.substring(0,1).toLowerCase()+e.substring(1)+m)},d=function(e){return("#"+e.substring(0,1).toLowerCase()+e.substring(1))};try{g=c.resolve(h);for(l in g){j.debug("Scan Checking %s.%s",h,l);if(c.isFunction(g[l])){j.debug("Found Function Definition on %s.%s",h,l);if(h.match(".Models")){j.debug("Configuring by Convention %s.%s",h,l);i.push({id:f(l,"Model"),clazz:h+"."+l})}else{if(h.match(".Views")){j.debug("Configuring by Convention %s.%s",h,l);i.push({id:f(l,"View"),clazz:h+"."+l,selector:d(l)})}else{if(h.match(".Controllers")){j.debug("Configuring by Convention %s.%s",h,l);i.push({id:f(l,"Controller"),clazz:h+"."+l})}else{if(h.match(".Services")){j.debug("Configuring by Convention %s.%s",h,l);i.push({id:f(l,"Service"),clazz:h+"."+l})}}}}}}}catch(k){j.error("Error Scanning %s!!",h).exception(k)}return i},initializeHijaxController:function(h,g,e,d){var j;var f;if(h[g]){for(f=0;f<h[g].length;f++){j={};j.id=h[g][f].id;j.clazz=e;j.options=[c.extend(true,{},d,h[g][f])];this.logger.debug("Adding MVC Configuration for Controller Id: %s",j.id);this.add(j.id,j)}}}})})(jQuery,Claypool,Claypool.MVC);(function(c,a,b){b.Container=function(e){a.extend(this,a.Application.ContextContributor);c.extend(true,this,e);this.factory=null;this.logger=c.logger("Claypool.MVC.Container").debug("Configuring Claypool MVC Container");this.factory=new b.Factory();this.factory.updateConfig();var d,f;for(f in this.factory.cache){d=this.get(f);this.logger.debug("attaching mvc core controller: %s",f);d.attach()}};c.extend(b.Container.prototype,a.Application.ContextContributor.prototype,{get:function(g){var d;try{this.logger.debug("Search for a container managed controller : %s",g);d=this.find(g);if(d===undefined||d===null){this.logger.debug("Can't find a container managed controller : %s",g);d=this.factory.create(g);if(d!==null){this.add(g,d);return d._this}else{return null}}else{this.logger.debug("Found container managed controller : %s",g);return d._this}}catch(f){this.logger.exception(f);throw new b.ContainerError()}throw new b.FactoryError(g)}})})(jQuery,Claypool,Claypool.MVC);(function(c,a,b){b.ContainerError=function(d){c.extend(this,new a.Error(d,{name:"Claypool.MVC.ContainerError",message:"An error occurred trying to retreive a container managed object."}))}})(jQuery,Claypool,Claypool.MVC);(function(c,a,b){b.FactoryError=function(d){c.extend(this,new a.Error(d,{name:"Claypool.MVC.FactoryError",message:"An error occured trying to create the factory object."}))}})(jQuery,Claypool,Claypool.MVC);(function(c,a,b){b.ConfigurationError=function(d){c.extend(this,new a.ConfigurationError(d,{name:"Claypool.MVC.ConfigurationError",message:"An error occured during the configuration."}))}})(jQuery,Claypool,Claypool.MVC);(function(c,a,b){c.extend(c,{router:function(e,d){c(document).bind("claypool:hijax",function(f,i,g,h){g.apply(i,[h,e,"Claypool.MVC.HijaxController",d])});return this},mvc:function(){if(arguments.length===0){return c.config("mvc")}else{return c.config("mvc",arguments[0])}}});c.router("hijax:a",{selector:"a",event:"click",strategy:"first",routerKeys:"urls",hijaxKey:"link",eventNamespace:"Claypool:MVC:HijaxLinkController",target:function(e){var d=e.target||e.currentTarget;while(d.tagName.toUpperCase()!="A"){d=c(d).parent()[0]}return c(d).attr("href")}}).router("hijax:button",{selector:":button",event:"click",strategy:"all",routerKeys:"ids",hijaxKey:"button",eventNamespace:"Claypool:MVC:HijaxButtonController",target:function(d){return d.target.id}}).router("hijax:input",{selector:"input",event:"blur|focus",strategy:"all",routerKeys:"ids",hijaxKey:"input",eventNamespace:"Claypool:MVC:HijaxInputController",target:function(d){return d.target.id}}).router("hijax:form",{selector:"form",event:"submit",strategy:"first",routerKeys:"urls",hijaxKey:"form",eventNamespace:"Claypool:MVC:HijaxFormController",target:function(d){return d.target.action}}).router("hijax:event",{strategy:"all",routerKeys:"event",hijaxKey:"event",eventNamespace:"Claypool:MVC:HijaxEventController",target:function(d){return d.type}}).router("hijax:image-rollover",{selector:"img",event:"mouseover|mouseout",strategy:"all",routerKeys:"urls",hijaxKey:"image",eventNamespace:"Claypool:MVC:HijaxImageRolloverController",target:function(d){return d.target.src
}});c.mvc_scanner=b.Factory.prototype})(jQuery,Claypool,Claypool.MVC);