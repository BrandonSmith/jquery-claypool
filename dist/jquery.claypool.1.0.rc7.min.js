/*
 * Claypool 1.0.rc7 - A Web 1.6180339... Javascript Application Framework
 *
 * Copyright (c) 2008 Chris Thatcher (claypooljs.com)
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * $Date: 2008-09-27 13:17:28 -0400 (Sat, 27 Sep 2008) $
 * $Rev: 273 $
 */
var Claypool={Logging:{},extend:function(t,$class){$class.apply(t,[]);}};(function($,$$){$$.Logging.NullLogger=function(){var nullFunction=function(){return this;};$.extend(this,{debug:nullFunction,info:nullFunction,warn:nullFunction,error:nullFunction,exception:nullFunction});return this;};$.extend($$.Logging.NullLogger.prototype,{getLogger:function(){return new $$.Logging.NullLogger();}});})(jQuery,Claypool);(function($,$$){$$.Configuration={ioc:[],aop:[],logging:[],mvc:{"hijax:a":[],"hijax:form":[],"hijax:button":[],"hijax:event":[]},env:{dev:{},prod:{},test:{}}};})(jQuery,Claypool);(function($,$$){$$.CachingStrategy$Interface={cache:null,size:null,clear:function(){throw new $$.MethodNotImplementedError();},add:function(id,object){throw new $$.MethodNotImplementedError();},remove:function(id){throw new $$.MethodNotImplementedError();},find:function(id){throw new $$.MethodNotImplementedError();}};})(jQuery,Claypool);(function($,$$){$$.SimpleCachingStrategy=function(options){$.extend(true,this,options);this.logger=new $$.Logging.NullLogger();this.clear();return this;};$.extend($$.SimpleCachingStrategy.prototype,$$.CachingStrategy$Interface,{clear:function(){this.logger.debug("Clearing Cache.");this.cache=null;this.cache={};this.size=0;},add:function(id,object){this.logger.debug("Adding To Cache: %s",id);if(!this.cache[id]){this.cache[id]=object;this.size++;return id;}return null;},remove:function(id){this.logger.debug("Removing From Cache id: %s",id);if(this.find(id)){return(delete this.cache[id])?--this.size:-1;}return null;},find:function(id){this.logger.debug("Searching Cache for id: %s",id);return this.cache[id]||null;}});})(jQuery,Claypool);(function($,$$){$$.Context=function(options){$$.extend(this,$$.SimpleCachingStrategy);$.extend(true,this,options);this.logger=new $$.Logging.NullLogger();};$.extend($$.Context.prototype,$$.SimpleCachingStrategy.prototype,{get:function(id){throw new $$.MethodNotImplementedError();},put:function(id,object){throw new $$.MethodNotImplementedError();}});})(jQuery,Claypool);(function($,$$){$$.ContextContributor=function(options){$$.extend(this,$$.Context);$.extend(true,this,options);this.logger=$.logger("Claypool.ContextContributor");};$.extend($$.ContextContributor.prototype,$$.Context.prototype,{registerContext:function(id){throw new $$.MethodNotImplementedError();}});})(jQuery,Claypool);(function($,$$){$$.Router=function(options){$$.extend(this,$$.SimpleCachingStrategy);$.extend(true,this,options);this.logger=$$.Logging.getLogger("Claypool.Router");};$.extend($$.Router.prototype,$$.SimpleCachingStrategy.prototype,{compile:function(patternMap,patternKey){this.logger.debug("compiling patterns for match strategies");var pattern,routable;var i,j;patternKey=patternKey.split('|');for(i=0;i<patternMap.length;i++){for(j=0;j<patternKey.length;j++){pattern=patternMap[i][patternKey[j]];if(pattern){this.logger.debug("Compiling \n\tpattern: %s for \n\ttarget.",pattern);this.add(String($.guid()),{pattern:new RegExp(pattern),payload:patternMap[i]});}}}return this;},first:function(string){this.logger.debug("Using strategy 'first'");var route,id;for(id in this.cache){route=this.find(id);this.logger.debug("checking pattern %s for string %s",route.pattern,string);if(route&&route.pattern&&route.pattern.test&&route.pattern.test(string)){this.logger.debug("found match for \n\tpattern: %s \n\ttarget : %s ",route.pattern,route.payload.controller||route.payload.rewrite);return[route];}}this.logger.debug("found no match for \n\tpattern: %s",string);return[];},all:function(string){this.logger.debug("Using strategy 'all'");var routeList=[];var route,id;for(id in this.cache){route=this.find(id);this.logger.debug("checking pattern: %s for string %s",route.pattern,string);if(route&&route.pattern&&route.pattern.test&&route.pattern.test(string)){this.logger.debug("found match for \n\tpattern: %s \n\ttarget : %s ",route.pattern,route.payload.controller);routeList.push(route);}}if(routeList.length===0){this.logger.debug("found no match for \n\tpattern: %s",string);}return routeList;}});})(jQuery,Claypool);(function($,$$){$$.Factory$Interface={create:function(){throw new $$.MethodNotImplementedError();}};})(jQuery,Claypool);(function($,$$){$$.Configurable$Interface={configurationId:null,configuration:null,configurationUrl:null,configurationType:null,getConfig:function(){throw new $$.MethodNotImplementedError();},loadConfig:function(){throw new $$.MethodNotImplementedError();},setConfig:function(){throw new $$.MethodNotImplementedError();},updateConfig:function(){throw new $$.MethodNotImplementedError();}};})(jQuery,Claypool);(function($,$$){$$.Scanner$Interface={scan:function(){throw new $$.MethodNotImplementedError();}};})(jQuery,Claypool);(function($,$$){$$.BaseFactory=function(options){$$.extend(this,$$.SimpleCachingStrategy);$.extend(true,this,{configurationUrl:"./app/configs/config.js",configurationType:"json"},options);this.logger=new $$.Logging.NullLogger();return this;};$.extend($$.BaseFactory.prototype,$$.SimpleCachingStrategy.prototype,$$.Factory$Interface,$$.Configurable$Interface,$$.Scanner$Interface,{getConfig:function(){if(!this.configuration){this.logger.warn("Configuration for <%s> has not been set explicitly or has been updated implicitly.",this.configurationId);try{this.logger.debug("$$.Configuration: \n %o",$$.Configuration);if($$.Configuration[this.configurationId]){this.logger.info("Found Claypool.Configuration");this.configuration=$$.Configuration[this.configurationId];}else if(!$$.Configuration){this.loadConfig();}}catch(e){this.logger.exception(e);throw new $$.ConfigurationError(e);}}return this.configuration;},loadConfig:function(options){options=options||{};this.configurationUrl=options.url||this.configurationUrl;this.logger.info("Attempting to load configuration from: %s",this.configurationUrl);var _this=this;try{jQuery.ajax({type:"Get",url:this.configurationUrl,async:false,data:{},dataType:"json",success:function(json){if(_this.configurationUrl=='./app/configs/config.js'){$$.Configuration=$$.Configuration||{};$.extend(true,$$.Configuration,json);}else{_this.setConfig(_this.configurationId,json?json:null);}if(options.callback){options.callback($$.Configuration);}}});}catch(e){this.logger.exception(e);throw new $$.ConfigurationError(e);}},setConfig:function(id,configuration){this.logger.info("Setting configuration");this.configuration=configuration;$$.Configuration[id]=configuration;},updateConfig:function(id){throw new $$.MethodNotImplementedError();}});})(jQuery,Claypool);(function($,$$){$$.Error=function(e,options){$.extend(true,this,e||new Error());this.name=(options&&options.name?options.name:"Claypool.UnknownError")+" > Claypool.Error"+(this.name?(" > "+this.name):"");this.message=(options&&options.name?options.name:"No Message Provided \n Nested exception is:\n\t")+(this.message||"UnknownError");};})(jQuery,Claypool);(function($,$$){$$.ConfigurationError=function(e,options){var details={name:"Claypool.ConfigurationError",message:"An error occured trying to locate or load the system configuration."};$.extend(this,new $$.Error(e,options?{name:(options.name?(options.name+" > "):"")+details.name,message:(options.message?(options.message+" \n "):"")+details.message}:details));};})(jQuery,Claypool);(function($,$$){$$.MethodNotImplementedError=function(e,options){var details={name:"Claypool.MethodNotImplementedError",message:"Method not implemented."};$.extend(this,new $$.Error(e,options?{name:(options.name?(options.name+" > "):"")+details.name,message:(options.message?(options.message+" \n "):"")+details.message}:details));};})(jQuery,Claypool);(function($,$$){$$.NameResolutionError=function(e,options){var details={name:"Claypool.NameResolutionError",message:"Unexpected error resolving name."};$.extend(this,new $$.Error(e,options?{name:(options.name?(options.name+" > "):"")+details.name,message:(options.message?(options.message+" \n "):"")+details.message}:details));};})(jQuery,Claypool);(function($,$$){var globalContext=[],guid=0,plugins={},env;$.extend(plugins,{$:function(id,value){var a,i;if(value===undefined){a=null;for(i=0;i<globalContext.length;i++){a=globalContext[i]().get(id);if(a){return a;}}return null;}else{if(globalContext[0]().find(id)){globalContext[0]().remove(id);}globalContext[0]().put(id,value);}},register:function(context,priority){if(Math.abs(priority)>(globalContext.length-1)/2){if(priority===0&&$.isFunction(context.getContext)){globalContext[0]=context.getContext;}else if(priority!==0){if($.isFunction(context.getContext)){globalContext.push(context.getContext);}if($.isFunction(context.getCachedContext)){globalContext.unshift(context.getCachedContext);}}}},guid:function(){return(++guid)+"-"+new Date().getTime()+"-"+Math.round(Math.random()*100000000);},resolve:function(namespacedName){var _resolver;var namespaces;var target;var i;try{_resolver=function(name){return this[name];};namespaces=namespacedName.split('.');target=null;for(i=0;i<namespaces.length;i++){target=_resolver.call(target,namespaces[i]);if(target===undefined){return target;}}return target;}catch(e){throw new $$.NameResolutionError(e);}},config:function(){var config,subconfig;if(arguments.length===0){return $$.Configuration;}else if(arguments.length===1&&typeof(arguments[0])=="string"){return $.resolve("Claypool.Configuration."+arguments[0]);}else{config=$.resolve("Claypool.Configuration."+arguments[0]);if(config){subconfig=arguments[1];if(subconfig instanceof Array){config=$.merge(config,subconfig);}else if(subconfig instanceof Object){config=$.extend(true,config,subconfig);}}}return this;},env:function(){if(arguments.length==2){env=$.extend(env||{},$.config('env.'+arguments[0]),$.config('env.'+arguments[1]));return env;}else{return env[arguments[0]]||null;}}});$.extend($$,plugins);$.extend($,plugins);})(jQuery,Claypool);Claypool.Logging={NullLogger:null,getLogger:null};(function($,$$,$$Log){$.extend($$Log,{loggerFactory:null,getLogger:function(category){if(!$$Log.loggerFactory){$$Log.loggerFactory=new $$Log.Factory();$$Log.loggerFactory.updateConfig();}return $$Log.loggerFactory.create(category);}});})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){$$Log.Level={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){$$Log.Logger$Interface={debug:function(){throw new $$.MethodNotImplementedError();},info:function(){throw new $$.MethodNotImplementedError();},warn:function(){throw new $$.MethodNotImplementedError();},error:function(){throw new $$.MethodNotImplementedError();},exception:function(){throw new $$.MethodNotImplementedError();}};})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){$$Log.NullLogger=function(){var nullFunction=function(){return this;};$.extend(this,{debug:nullFunction,info:nullFunction,warn:nullFunction,error:nullFunction,exception:nullFunction});};})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){$$Log.Logger=function(options){this.category="root";this.level=null;try{$.extend(true,this,options);this.level=$$Log.Level[this.level?this.level:"NONE"];try{this.appender=new($.resolve(this.appender||"Claypool.Logging.ConsoleAppender"))(options);}catch(e){try{this.appender=new $$Log.ConsoleAppender(options);}catch(e){this.appender=new $$Log.SysOutAppender(options);}}return this;}catch(e){return new $$Log.NullLogger();}};$.extend($$Log.Logger.prototype,$$Log.Logger$Interface,{debug:function(){if(this.level<=$$Log.Level.DEBUG){this.appender.append("DEBUG",this.category,arguments);return this;}else{this.debug=function(){return this;};}return this;},info:function(){if(this.level<=$$Log.Level.INFO){this.appender.append("INFO",this.category,arguments);return this;}else{this.debug=function(){return this;};}return this;},warn:function(){if(this.level<=$$Log.Level.WARN){this.appender.append("WARN",this.category,arguments);return this;}else{this.debug=function(){return this;};}return this;},error:function(){if(this.level<=$$Log.Level.ERROR){this.appender.append("ERROR",this.category,arguments);return this;}else{this.debug=function(){return this;};}return this;},exception:function(e){if(this.level<$$Log.Level.NONE){if(e){this.appender.append("EXCEPTION",this.category,e);return this;}}else{this.debug=function(){return this;};}return this;}});})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){$$Log.Appender$Interface={formatter:null,append:function(level,category,message){throw new $$.MethodNotImplementedError();}};})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){$$Log.SysOutAppender=function(options){var rhinoCheck=function(){var isRhino=null;isRhino.toString();};if($.isFunction(print)&&(window.load!==undefined)&&$.isFunction(window.load)){try{rhinoCheck();}catch(caught){if(caught.rhinoException){$.extend(true,this,options);this.formatter=new $$Log.DefaultFormatter(options);return this;}}}throw new $$Log.NoAppendersAvailableError();};$.extend($$Log.SysOutAppender.prototype,$$Log.Appender$Interface,{append:function(level,category,message){switch(level){case"DEBUG":print(this.formatter.format(level,category,message));break;case"INFO":print(this.formatter.format(level,category,message));break;case"WARN":print(this.formatter.format(level,category,message));break;case"ERROR":print(this.formatter.format(level,category,message));break;case("EXCEPTION"):var msg=message&&message.rhinoException?"\n\t"+message.rhinoException.message+"\tcolumn: "+message.rhinoException.columnNumber()+"\tline: "+message.rhinoException.lineNumber():"UNKNOWN RUNTIME ERROR";print(this.formatter.format(level,category,msg));break;}}});})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){$$Log.ConsoleAppender=function(options){try{if(window&&window.console&&window.console.log){$.extend(true,this,options);this.formatter=new $$Log.FireBugFormatter(options);return this;}else{return new $$Log.SysOutAppender(options);}}catch(e){}return this;};$.extend($$Log.ConsoleAppender.prototype,$$Log.Appender$Interface,{append:function(level,category,message){switch(level){case("DEBUG"):console.log.apply(console,this.formatter.format(level,category,message));break;case("INFO"):console.info.apply(console,this.formatter.format(level,category,message));break;case("WARN"):console.warn.apply(console,this.formatter.format(level,category,message));break;case("ERROR"):console.error.apply(console,this.formatter.format(level,category,message));break;case("EXCEPTION"):console.error.apply(console,this.formatter.format(level,category,message.message?[message.message]:[]));console.trace();break;}}});})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){$$Log.Formatter$Interface={format:function(level,category,objects){throw new $.MethodNotImplementedError();}};})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){$$Log.FireBugFormatter=function(options){$.extend(true,this,options);};$.extend($$Log.FireBugFormatter.prototype,$$Log.Formatter$Interface,{getDateString:function(){return" ["+new Date().toUTCString()+"] ";},format:function(level,category,objects){var msgPrefix=category+" "+level+": "+this.getDateString();objects=(objects&&objects.length&&(objects.length>0))?objects:[];var msgFormat=(objects.length>0)?objects[0]:null;if(typeof(msgFormat)!="string"){objects.unshift(msgPrefix);}else{objects[0]=msgPrefix+msgFormat;}return objects;}});})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){var parseFormatRegExp=/((^%|[^\\]%)(\d+)?(\.)([a-zA-Z]))|((^%|[^\\]%)([a-zA-Z]))/,functionRenameRegExp=/function ?(.*?)\(/,objectRenameRegExp=/\[object (.*?)\]/;$$Log.DefaultFormatter=function(options){$.extend(true,this,options);};$.extend($$Log.DefaultFormatter.prototype,$$Log.Formatter$Interface,{getDateString:function(){return" ["+new Date().toUTCString()+"] ";},format:function(level,category,objects){var msgPrefix=" "+level+":  "+this.getDateString()+"{"+category+"} ";var msg=[msgPrefix?msgPrefix:""];var format=objects[0];var objIndex=0;if(typeof(format)!="string"){format="";objIndex=-1;}var parts=this.parseFormat(format);var i;for(i=0;i<parts.length;++i){if(parts[i]&&typeof(parts[i])=="object"){parts[i].appender.call(this,objects[++objIndex],msg);}else{this.appendText(parts[i],msg);}}for(i=objIndex+1;i<objects.length;++i){this.appendText(" ",msg);if(typeof(objects[i])=="string"){this.appendText(objects[i],msg);}else{this.appendObject(objects[i],msg);}}return msg.join("");},parseFormat:function(format){var parts=[];var appenderMap={s:this.appendText,d:this.appendInteger,i:this.appendInteger,f:this.appendFloat};var type;var appender;var precision;var m;for(m=parseFormatRegExp.exec(format);m;m=parseFormatRegExp.exec(format)){type=m[8]?m[8]:m[5];appender=type in appenderMap?appenderMap[type]:this.appendObject;precision=m[3]?parseInt(m[3],10):(m[4]=="."?-1:0);parts.push(format.substr(0,m[0][0]=="%"?m.index:m.index+1));parts.push({appender:appender,precision:precision});format=format.substr(m.index+m[0].length);}parts.push(format);return parts;},objectToString:function(object){try{return object+"";}catch(e){return null;}},appendText:function(object,msg){msg.push(this.objectToString(object));},appendNull:function(object,msg){msg.push(this.objectToString(object));},appendString:function(object,msg){msg.push(this.objectToString(object));},appendInteger:function(object,msg){msg.push(this.objectToString(object));},appendFloat:function(object,msg){msg.push(this.objectToString(object));},appendFunction:function(object,msg){var m=functionRenameRegExp.exec(this.objectToString(object));var name=m?m[1]:"function";msg.push(this.objectToString(name));},appendObject:function(object,msg){try{if(object===undefined){this.appendNull("undefined",msg);}else if(object===null){this.appendNull("null",msg);}else if(typeof object=="string"){this.appendString(object,msg);}else if(typeof object=="number"){this.appendInteger(object,msg);}else if(typeof object=="function"){this.appendFunction(object,msg);}else if(object.nodeType==1){this.appendSelector(object,msg);}else if(typeof object=="object"){this.appendObjectFormatted(object,msg);}else{this.appendText(object,msg);}}catch(e){}},appendObjectFormatted:function(object,msg){var text=this.objectToString(object);var m=objectRenameRegExp.exec(text);msg.push(m?m[1]:text);},appendSelector:function(object,msg){msg.push(object.nodeName.toLowerCase());if(object.id){msg.push(object.id);}if(object.className){msg.push(object.className);}msg.push('</span>');},appendNode:function(node,msg){var attr;var i;var child;if(node.nodeType==1){msg.push('<',node.nodeName.toLowerCase(),'>');for(i=0;i<node.attributes.length;++i){attr=node.attributes[i];if(!attr.specified){continue;}msg.push(attr.nodeName.toLowerCase(),'="',attr.nodeValue,'"');}if(node.firstChild){for(child=node.firstChild;child;child=child.nextSibling){this.appendNode(child,html);}msg.push('</',node.nodeName.toLowerCase(),'>');}else{msg.push('/>');}}else if(node.nodeType==3){msg.push(node.nodeValue);}}});})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){$$Log.Factory=function(options){$$.extend(this,$$.BaseFactory);this.configurationId='logging';$.extend(true,this,options);this.logger=new $$Log.Logger({category:"Claypool.Logging.Factory",level:"INFO",appender:"Claypool.Logging.ConsoleAppender"});this.attemptedConfigure=false;};$.extend($$Log.Factory.prototype,$$.BaseFactory.prototype,{create:function(category){var categoryParts,subcategory,loggerConf,rootLoggerConf;if(!this.configuration){if(!this.attemptedConfigure){this.logger.warn("Claypool Logging was not initalized correctly.  Logging will not occur unless initialized.");}this.attemptedConfigure=true;return new $$Log.NullLogger();}else{categoryParts=category.split(".");for(i=0;i<categoryParts.length;i++){subcategory=categoryParts.slice(0,categoryParts.length-i).join(".");loggerConf=this.find(subcategory);if(loggerConf!==null){loggerConf.category=category;return new $$Log.Logger(loggerConf);}}rootLoggerConf=this.find('root');if(rootLoggerConf!==null){rootLoggerConf.category=category;return new $$Log.Logger(rootLoggerConf);}}this.logger.warn("No Matching category: %s Please configure a root logger.",category);return new $$Log.NullLogger();},updateConfig:function(){var loggingConfiguration;var logconf;var i;try{this.logger.info("Configuring Claypool Logging");this.clear();loggingConfiguration=this.getConfig()||[];for(i=0;i<loggingConfiguration.length;i++){try{logconf=loggingConfiguration[i];this.add(logconf.category,logconf);}catch(ee){this.logger.exception(ee);return false;}}}catch(e){this.logger.exception(e);throw new $$Log.ConfigurationError(e);}return true;}});})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){$$Log.ConfigurationError=function(e,options){$.extend(this,new $$.ConfigurationError(e,options||{name:"Claypool.Logging.ConfigurationError",message:"An error occured trying to configure the logging system."}));};})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){$$Log.NoAppendersAvailableError=function(e,options){$.extend(this,new $$.Error(e,options||{name:"Claypool.Logging.NoAppendersAvailableError",message:"An error occured trying to configure the logging system."}));};})(jQuery,Claypool,Claypool.Logging);(function($,$$,$$Log){$.extend($,{logger:function(name){return $$Log.getLogger(name);}});var $log;$.extend($,{debug:function(){$log=$log||$.logger("jQuery");$log.debug.apply($log,arguments);return this;},info:function(){$log=$log||$.logger("jQuery");$log.info.apply($log,arguments);return this;},warn:function(){$log=$log||$.logger("jQuery");$log.warn.apply($log,arguments);return this;},error:function(){$log=$log||$.logger("jQuery");$log.error.apply($log,arguments);return this;},exception:function(){$log=$log||$.logger("jQuery");$log.exception.apply($log,arguments);return this;}});})(jQuery,Claypool,Claypool.Logging);Claypool.Application={};(function($,$$,$$App){var CONTEXT_PRIORITY=0;$$App.context=null;$.extend($$App,{getContext:function(){if(!$$App.context){$$App.context=new $$App.Context();}return $$App.context;},Initialize:function(callback){$(document).trigger("claypool:initialize",[$$App]);if(callback){callback();}$(document).trigger("ApplicationLoaded");return $$App.getContext();},Reinitialize:function(callback){$(document).trigger("claypool:reinitialize",[$$App]);if(callback){callback();}$(document).trigger("ApplicationReloaded");return $$App.getContext();}});$.register($$App,CONTEXT_PRIORITY);})(jQuery,Claypool,Claypool.Application);(function($,$$,$$App){$$App.Context=function(options){$$.extend(this,$$.Context);this.contextContributors={};$.extend(true,this,options);this.logger=$.logger("Claypool.Application.Context");};$.extend($$App.Context.prototype,$$.Context.prototype,{get:function(id){var contextObject;var contributor;try{this.logger.debug("Searching application context for object: %s",id);contextObject=null;contextObject=this.find(id);if(contextObject!==null){this.logger.debug("Found object in global application context. Object id: %s",id);return contextObject;}else{this.logger.debug("Searching for object in contributed application context. Object id: %s",id);for(contributor in this.contextContributors){this.logger.debug("Checking Application Context Contributor %s.",contributor);contextObject=this.contextContributors[contributor].get(id);if(contextObject!==null){this.logger.debug("Found object in contributed application context. Object id: %s",id);return contextObject;}}}this.logger.debug("Cannot find object in any application context. Object id: %s",id);return null;}catch(e){throw new $$App.ContextError(e);}},put:function(id,object){this.logger.debug("Adding object to global application context %s",id);this.add(id,object);}});})(jQuery,Claypool,Claypool.Application);(function($,$$,$$App){$$App.ContextContributor=function(options){$$.extend(this,$$.ContextContributor);$.extend(true,this,options);this.logger=$.logger("Claypool.Application.ContextContributor");return this;};$.extend($$App.ContextContributor.prototype,$$.ContextContributor.prototype,{registerContext:function(id){this.logger.info("Registering Context id: %s",id);$$App.getContext().contextContributors[id]=this;}});})(jQuery,Claypool,Claypool.Application);(function($,$$,$$App){$$App.Aware=function(options){$.extend(this,options);this.logger=$.logger("Claypool.Application.Aware");};$.extend($$App.Aware.prototype,{$:function(){return $$App.getContext();}});})(jQuery,Claypool,Claypool.Application);(function($,$$,$$App){$$App.ContextError=function(e,options){var details={name:"Claypool.Application.ContextError",message:"An unexpected error occured while searching the application context."};$.extend(this,new $$.Error(e,options?{name:(options.name?(options.name+" > "):"")+details.name,message:(options.message?(options.message+" \n "):"")+details.message}:details));};})(jQuery,Claypool,Claypool.Application);(function($,$$,$$App){$.extend($,{app:function(){return $$App.getContext();},boot:function(cb){$$App.Initialize(cb);return this;},reboot:function(cb){$$App.Reinitialize(cb);return this;},manage:function(containerName,managedId){$(document).bind("claypool:initialize",function(event,context){context.managedId=new($.resolve(containerName))();if(context.ContextContributor&&$.isFunction(context.ContextContributor)){context.managedId.registerContext(containerName);}}).bind("claypool:reinitialize",function(event,context){context.managedId.factory.updateConfig();});return this;}});})(jQuery,Claypool,Claypool.Application);Claypool.AOP={};(function($,$$,$$AOP){$.manage("Claypool.AOP.Container","claypool:AOP");})(jQuery,Claypool,Claypool.AOP);(function($,$$,$$AOP){$$AOP.Aspect=function(options){this.id=null;this.type=null;$$.extend(this,$$.SimpleCachingStrategy);$.extend(true,this,options);this.logger=$.logger("Claypool.AOP.Aspect");this.strategy=this.strategy||"all";};$.extend($$AOP.Aspect.prototype,$$.SimpleCachingStrategy.prototype,{weave:function(){var _this=this;var pattern;var targetObject;if(!this.target){_this.logger.warn("No pointcut was specified.  Cant weave aspect.");return;}var _weave=function(methodName){var pointcut,cutline;try{_this.logger.info("Weaving Advice %s for Aspect %s",methodName,_this.id);_this.hasPrototype=typeof(_this.target.prototype)!='undefined';cutline=_this.hasPrototype?_this.target.prototype[methodName]:_this.target[methodName];pointcut=_this.advise(cutline);if(!_this.hasPrototype){_this.target[methodName]=pointcut;}else{_this.target.prototype[methodName]=pointcut;}return{pointcut:pointcut,cutline:cutline};}catch(e){throw new $$AOP.WeaveError(e,"Weave");}};if(this.size===0){pattern=new RegExp(this[this.type?this.type:"method"]);targetObject=this.target.prototype?this.target.prototype:this.target;for(var f in targetObject){if($.isFunction(targetObject[f])&&pattern.test(f)){this.logger.debug("Adding aspect to method %s",f);this.add($.guid(),_weave(f));if(this.strategy==="first"){break;}}}}return this;},unweave:function(){var aspect;try{for(var id in this.cache){aspect=this.find(id);if(!this.hasPrototype){this.target[this.method]=aspect.cutline;}else{this.target.prototype[this.method]=aspect.cutline;}this.hasPrototype=null;}this.clear();}catch(e){throw new $$AOP.WeaveError(e,'Unweave');}return true;},advise:function(cutline){throw new $$.MethodNotImplementedError();}});})(jQuery,Claypool,Claypool.AOP);(function($,$$,$$AOP){$$AOP.After=function(options){$$.extend(this,$$AOP.Aspect);$.extend(true,this,options);this.logger=$.logger("Claypool.AOP.After");this.type="after";};$.extend($$AOP.After.prototype,$$AOP.Aspect.prototype,{advise:function(cutline){var _this=this;try{return function(){var returnValue=cutline.apply(this,arguments);return _this.advice.apply(_this,[returnValue]);};}catch(e){throw new $$AOP.AspectError(e,"After");}}});})(jQuery,Claypool,Claypool.AOP);(function($,$$,$$AOP){$$AOP.Before=function(options){$$.extend(this,$$AOP.Aspect);$.extend(true,this,options);this.logger=$.logger("Claypool.AOP.Before");this.type="before";};$.extend($$AOP.Before.prototype,$$AOP.Aspect.prototype,{advise:function(cutline){var _this=this;try{return function(){_this.advice.apply(_this,arguments);return cutline.apply(this,arguments);};}catch(e){throw new $$AOP.AspectError(e,"Before");}}});})(jQuery,Claypool,Claypool.AOP);(function($,$$,$$AOP){$$AOP.Around=function(options){$$.extend(this,$$AOP.Aspect);$.extend(true,this,options);this.logger=$.logger("Claypool.AOP.Around");this.type="around";};$.extend($$AOP.Around.prototype,$$AOP.Aspect.prototype,{advise:function(cutline){var _this=this;try{return function(){var invocation={object:this,args:arguments};return _this.advice.apply(_this,[{arguments:invocation.args,proceed:function(){var returnValue=cutline.apply(invocation.object,invocation.args);return returnValue;}}]);};}catch(e){throw new $$AOP.AspectError(e,"Around");}}});})(jQuery,Claypool,Claypool.AOP);(function($,$$,$$AOP){$$AOP.Factory=function(options){$$.extend(this,$$.BaseFactory);$.extend(true,this,options);this.configurationId='aop';this.aspectCache=null;this.logger=$.logger("Claypool.AOP.Factory");this.aspectCache=new $$.SimpleCachingStrategy();};$.extend($$AOP.Factory.prototype,$$.BaseFactory.prototype,{updateConfig:function(){var _this=this;var aopConfiguration;var aopconf;var i;var targetRef,namespace,prop,genconf;try{this.logger.debug("Configuring Claypool AOP AspectFactory");aopConfiguration=this.getConfig()||[];this.logger.debug("AOP Configurations: %d",aopConfiguration.length);for(i=0;i<aopConfiguration.length;i++){try{aopconf=aopConfiguration[i];if(!$.isFunction(aopconf.advice)){aopconf.advice=$.resolve(aopconf.advice);}if(aopconf.target.match("^ref://")){targetRef=aopconf.target.substr(6,aopconf.target.length);$(document).bind("claypool:ioc:"+targetRef,function(event,id,iocContainer){_this.logger.debug("Creating aspect id %s for instance %s",aopconf.id);var instance=iocContainer.find(id);aopconf.target=instance._this;_this.add(aopconf.id,aopconf);var aspect=_this.create(aopconf.id);instance._this=aspect.target;iocContainer.remove(id);iocContainer.add(id,instance);_this.logger.debug("Created aspect \n%s, \n%s");}).bind("claypool:predestroy:"+targetRef,function(event,instance){_this.logger.debug("Destroying aspect id %s for instance %s",aopconf.id);var aspect=_this.aspectCache.find(aopconf.id);if(aspect&&aspect.unweave){aspect.unweave();}});}else{if(aopconf.target.match(/\.\*^/)){namespace=$.resolve(aopconf.target.substring(0,aopconf.target.length-2));for(prop in namespace){if($.isFunction(namespace[prop])){genconf=$.extend({id:aopconf.id+$.createGUID(),target:namespace[prop]},aopconf);this.logger.debug("Creating aspect id %s",genconf.id);this.add(genconf.id);this.create(genconf.id);}}}else{this.logger.debug("Creating aspect id %s",aopconf.id);aopconf.target=$.resolve(aopconf.target);this.add(aopconf.id,aopconf);this.create(aopconf.id);}}}catch(e){this.logger.exception(e);}}}catch(e){this.logger.exception(e);throw new $$AOP.ConfigurationError(e);}return true;},create:function(id){var configuration;var _continuation;var aspect=this.aspectCache.find(id);var _this=this;var createWeave=function(options){var aspect=null;if(options.after){aspect=new $$AOP.After(options);}else if(options.before){aspect=new $$AOP.Before(options);}else if(options.around){aspect=new $$AOP.Around(options);}return aspect.weave();};if(aspect){return aspect;}else{try{this.logger.debug("Looking for configuration for aspect %s",id);configuration=this.find(id);if(configuration===undefined||configuration===null){this.logger.debug("%s is not an Aspect.",id);return null;}else{this.logger.debug("Found configuration for instance %s",id);if(configuration.selector){this.logger.debug("Attaching contructor to an active selector");_this=this;_continuation=function(){aspect=createWeave(configuration);_this.aspectCache.add(configuration.id+"#"+this.toString(),aspect);return aspect;};if(configuration.active){$(configuration.selector).livequery(_continuation);}else{$(configuration.selector).each(_continuation);}}else{aspect=createWeave(configuration);this.aspectCache.add(id,aspect);}return aspect;}}catch(e){this.logger.exception(e);throw new $$AOP.FactoryError(e);}}}});})(jQuery,Claypool,Claypool.AOP);(function($,$$,$$AOP){$$AOP.Container=function(options){$$.extend(this,$$.Application.ContextContributor);$.extend(true,this,options);this.factory=null;this.logger=$.logger("Claypool.AOP.Container");this.logger.debug("Configuring Claypool AOP Container");this.factory=new $$AOP.Factory(options);this.factory.updateConfig();};$.extend($$AOP.Container.prototype,$$.Application.ContextContributor.prototype,{get:function(id){var aspect;try{this.logger.debug("Search for a container managed aspect :%s",id);aspect=this.find(id);if(aspect===undefined||aspect===null){this.logger.debug("Can't find a container managed aspect :%s",id);aspect=this.factory.create(id);if(aspect!==null){this.add(id,aspect);return aspect;}}else{this.logger.debug("Found container managed instance :%s",id);return aspect;}}catch(e){this.logger.exception(e);throw new $$AOP.ContainerError(e);}return null;}});})(jQuery,Claypool,Claypool.AOP);(function($,$$,$$AOP){$$AOP.ContainerError=function(e,options){var details={name:"Claypool.AOP.ContainerError",message:"An error occured inside the aop container."};$.extend(this,new $$.Error(e,options?{name:(options.name?(options.name+" > "):"")+details.name,message:(options.message?(options.message+" \n "):"")+details.message}:details));};})(jQuery,Claypool,Claypool.AOP);(function($,$$,$$AOP){$$AOP.ConfigurationError=function(e,options){var details={name:"Claypool.AOP.ConfigurationError",message:"An error occured updating the aop container configuration."};$.extend(this,new $$.ConfigurationError(e,options?{name:(options.name?(options.name+" > "):"")+details.name,message:(options.message?(options.message+" \n "):"")+details.message}:details));};})(jQuery,Claypool,Claypool.AOP);(function($,$$,$$AOP){$$AOP.FactoryError=function(e,options){var details={name:"Claypool.AOP.FactoryError",message:"An error occured creating the aspect from the configuration."};$.extend(this,new $$.Error(e,options?{name:(options.name?(options.name+" > "):"")+details.name,message:(options.message?(options.message+" \n "):"")+details.message}:details));};})(jQuery,Claypool,Claypool.AOP);(function($,$$,$$AOP){$$AOP.WeaveError=function(e,options){var details={name:"Claypool.AOP.WeaveError",message:"An error occured weaving or unweaving the aspect."};$.extend(this,new $$.Error(e,options?{name:(options.name?(options.name+" > "):"")+details.name,message:(options.message?(options.message+" \n "):"")+details.message}:details));};})(jQuery,Claypool,Claypool.AOP);(function($,$$,$$AOP){$$AOP.AspectError=function(e,options){var details={name:"Claypool.AOP.AspectError",message:"An error occured while applying an aspect."};$.extend(this,new $$.Error(e,options?{name:(options.name?(options.name+" > "):"")+details.name,message:(options.message?(options.message+" \n "):"")+details.message}:details));};})(jQuery,Claypool,Claypool.AOP);Claypool.IoC={};(function($,$$,$$IoC){$.manage("Claypool.IoC.Container","claypool:IoC");})(jQuery,Claypool,Claypool.IoC);(function($,$$,$$IoC){$$IoC.Instance=function(id,configuration){$.extend(this,{_this:null,id:null,configuration:null,guid:$.guid(),type:null,id:id,configuration:configuration||{},logger:$.logger("Claypool.IoC.Instance")});this.logger.category=this.logger.category+"."+this.id;};$.extend($$IoC.Instance.prototype,{precreate:function(){try{this._this={claypoolId:this.id};this.logger.debug("Precreating Instance");$(document).trigger("claypool:precreate",[this._this,this.id]);$(document).trigger("claypool:precreate:"+this.id,[this._this]);return this;}catch(e){this.logger.error("An Error occured in the Pre-Create LifeCycle Phase");this.logger.exception(e);throw new $$IoC.LifeCycleError(e);}},create:function(){var factory,factoryClass,factoryMethod,retVal;var _this,_thisOrUndefined,C_onstructor,args;var injections,injectionValue;try{this.logger.debug("Applying Selector to Instance");if(this.configuration.selector){this._this=$(this.configuration.selector);this.logger.debug("Result for selector : ",this._this);}else{this.logger.debug("Using default empty object");this._this={};}if(this.configuration.factory){factory={};if(this.configuration.factory.substring(6,0)=="ref://"){this.logger.debug("Retreiving Factory from Application Context");factory=$.$(this.configuration.factory);}else{this.logger.info("Creating Instance from Factory");factoryClass=this.resolveConstructor(this.configuration.factory);retval=factoryClass.apply(factory,this.configuration.options);factory=retval||factory;}this.logger.debug("Applying factory creation method");factoryMethod=this.configuration.factoryMethod||"create";_this=factory[factoryMethod].apply(factory,this.configuration.options);this._this=$.extend(true,_this,this._this);}else{this.logger.info("Creating Instance simulating constructor: %s",this.configuration.clazz);C_onstructor=this.resolveConstructor(this.configuration.clazz);args=this.configuration.options||[];_this={};switch(args.length){case 0:_this=new C_onstructor();break;case 1:_this=new C_onstructor(args[0]);break;case 2:_this=new C_onstructor(args[0],args[1]);break;case 3:_this=new C_onstructor(args[0],args[1],args[2]);break;case 4:_this=new C_onstructor(args[0],args[1],args[2],args[3]);break;case 5:_this=new C_onstructor(args[0],args[1],args[2],args[3],args[4]);break;case 6:_this=new C_onstructor(args[0],args[1],args[2],args[3],args[4],args[5]);break;case 7:_this=new C_onstructor(args[0],args[1],args[2],args[3],args[4],args[5],args[6]);break;case 8:_this=new C_onstructor(args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7]);break;case 9:_this=new C_onstructor(args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7],args[8]);break;default:_thisOrUndefined=C_onstructor.apply(_this,args);_this=_thisOrUndefined||_this;}_this.$ns=this.configuration.clazz;_this.$log=$.logger(_this.$ns);_this.$log.info("Created new instance of %s",_this.$ns);this._this=$.extend(true,_this,this._this);}injections=this.configuration.inject||{};for(var dependency in injections){injectionValue=injections[dependency];if($.isFunction(injectionValue.substring)&&(injectionValue.substring(0,6)=='ref://')){injections[dependency]=$.$(injectionValue.substring(6,injectionValue.length));}}$.extend(this._this,injections);$(document).trigger("claypool:create",[this._this,this.id]);$(document).trigger("claypool:create:"+this.id,[this._this]);return this._this;}catch(e){this.logger.error("An Error occured in the Create LifeCycle Phase");this.logger.exception(e);throw new $$IoC.LifeCycleError(e);}},postcreate:function(){try{this.logger.debug("PostCreate invoked");$(document).trigger("claypool:postcreate",[this._this,this.id]);$(document).trigger("claypool:postcreate:"+this.id,[this._this]);return this._this;}catch(e){this.logger.error("An Error occured in the Post-Create LifeCycle Phase");this.logger.exception(e);throw new $$IoC.LifeCycleError(e);}},predestroy:function(){try{this.logger.debug("Predestory invoked");$(document).trigger("claypool:predestroy",[this._this,this.id]);$(document).trigger("claypool:predestroy:"+this.id,[this._this]);return this._this;}catch(e){this.logger.exception(e);throw new $$IoC.LifeCycleError(e);}},destroy:function(){try{this.logger.info("Destroy invoked");$(document).trigger("claypool:destroy",[this._this,this.id]);$(document).trigger("claypool:destroy:"+this.id,[this._this]);return delete this._this;}catch(e){this.logger.exception(e);throw new $$IoC.LifeCycleError(e);}},postdestroy:function(){try{this.logger.debug("Postdestory invoked");$(document).trigger("claypool:postdestroy",[this.id]);$(document).trigger("claypool:postdestroy:"+this.id);return this;}catch(e){this.logger.exception(e);throw new $$IoC.LifeCycleError(e);}},resolveConstructor:function(constructorName){var constructor;try{constructor=$.resolve(constructorName);if($.isFunction(constructor)){this.logger.debug(" Resolved "+constructorName+" to a function");return constructor;}else{throw new Error("Constructor is not a function: "+constructorName);}}catch(e){this.logger.exception(e);throw new $$IoC.ConstructorResolutionError(e);}}});})(jQuery,Claypool,Claypool.IoC);(function($,$$,$$IoC){$$IoC.Factory=function(options){$$.extend(this,$$.BaseFactory);$.extend(true,this,options);this.configurationId='ioc';this.logger=$.logger("Claypool.IoC.Factory");};$.extend($$IoC.Factory.prototype,$$.BaseFactory.prototype,{createLifeCycle:function(instance){try{instance.precreate();instance.create();instance.postcreate();}catch(e){this.logger.error("An Error occured in the Creation Lifecycle.");this.logger.exception(e);throw new $$IoC.LifeCycleError(e);}},destroyLifeCycle:function(instance){try{instance.predestroy();instance.destroy();instance.postdestroy();}catch(e){this.logger.error("An Error occured in the Destory Lifecycle.");this.logger.exception(e);throw new $$IoC.LifeCycleError(e);}},create:function(id){var configuration;var instance;var _this=this;try{this.logger.debug("Looking for configuration for instance %s",id);configuration=this.find(id);if(configuration===null){this.logger.warn("No known configuration for instance %s",id);return null;}else{this.logger.debug("Found configuration for instance %s",id);instance=new $$IoC.Instance(configuration.id,configuration);if(configuration.active&&configuration.selector){this.logger.debug("Attaching contructor to an active selector");instance.precreate();instance._this["@claypool:activeobject"]=configuration.selector;instance._this["@claypool:id"]=instance.id;jQuery(configuration.selector).livequery(function(){_this.logger.debug("Processing Creation Lifecycle.");_this.createLifeCycle(instance);},function(){_this.logger.debug("Processing Destruction Lifecycle.");_this.destroyLifeCycle(instance);});}else{this.logger.debug("Processing Creation Lifecycle.");this.createLifeCycle(instance);}return instance;}}catch(e){this.logger.exception(e);throw new $$IoC.FactoryError(e);}},updateConfig:function(){var iocConfiguration;var iocconf;var i;try{this.logger.debug("Configuring Claypool IoC Factory");iocConfiguration=this.getConfig()||[];this.logger.debug("IoC Configurations: %d",iocConfiguration.length);for(i=0;i<iocConfiguration.length;i++){try{iocconf=iocConfiguration[i];if(iocconf.scan&&iocconf.factory){this.logger.debug("Scanning %s with %s",iocconf.scan,iocconf.factory);iocConfiguration=iocConfiguration.concat(iocconf.factory.scan(iocconf.scan));}else{this.logger.debug("IoC Configuration for Id: %s",iocconf.id);this.add(iocconf.id,iocconf);}}catch(e){this.logger.exception(e);return false;}}}catch(e){this.logger.exception(e);throw new $$IoC.ConfigurationError(e);}return true;}});})(jQuery,Claypool,Claypool.IoC);(function($,$$,$$IoC){$$IoC.Container=function(options){$$.extend(this,$$.Application.ContextContributor);$.extend(true,this,options);this.factory=null;this.logger=$.logger("Claypool.IoC.Container");this.logger.debug("Configuring Claypool IoC Container");this.factory=new $$IoC.Factory();this.factory.updateConfig();};$.extend($$IoC.Container.prototype,$$.Application.ContextContributor.prototype,{get:function(id){var instance;var _this=this;try{this.logger.debug("Search for a container managed instance :%s",id);instance=this.find(id);if(!instance){this.logger.debug("Can't find a container managed instance :%s",id);instance=this.factory.create(id);if(instance){this.logger.debug("Storing managed instance %s in container",id);this.add(id,instance);if(instance._this["@claypool:activeobject"]){$(document).bind('claypool:postcreate:'+instance.id,function(event,reattachedObject,id){_this.logger.info("Reattached Active Object Inside IoC Container");instance._this=reattachedObject;});$(document).bind('claypool:postdestroy:'+instance.id,function(){_this.logger.info("Removed Active Object Inside IoC Container");_this.remove(id);});}else{$(document).trigger("claypool:ioc",[id,this]);$(document).trigger("claypool:ioc:"+id,[id,this]);}return this.find(id)._this;}}else{this.logger.debug("Found container managed instance :%s",id);return instance._this;}}catch(e){this.logger.exception(e);throw new $$IoC.ContainerError(e);}return null;}});})(jQuery,Claypool,Claypool.IoC);(function($,$$,$$IoC){$$IoC.ContainerError=function(e){$.extend(this,new $$.Error(e,{name:"Claypool.IoC.ContainerError",message:"An error occured in the ioc instance factory."}));};})(jQuery,Claypool,Claypool.IoC);(function($,$$,$$IoC){$$IoC.FactoryError=function(e){$.extend(this,new $$.Error(e,{name:"Claypool.IoC.FactoryError",message:"An error occured in the ioc factory."}));};})(jQuery,Claypool,Claypool.IoC);(function($,$$,$$IoC){$$IoC.ConfigurationError=function(e){$.extend(this,new $$.ConfigurationError(e,{name:"Claypool.IoC.ConfigurationError",message:"An error occured updating the ioc container configuration."}));};})(jQuery,Claypool,Claypool.IoC);(function($,$$,$$IoC){$$IoC.LifeCycleError=function(e){$.extend(this,new $$.Error(e,{name:"Claypool.IoC.LifeCycleError",message:"An error occured during the lifecycle process."}));};})(jQuery,Claypool,Claypool.IoC);(function($,$$,$$IoC){$$IoC.ConstructorResolutionError=function(e){$.extend(this,new $$.NameResolutionError(e,{name:"Claypool.IoC.ConstructorResolutionError",message:"An error occured trying to resolve the constructor."}));};})(jQuery,Claypool,Claypool.IoC);(function($,$$,$$IoC){})(jQuery,Claypool,Claypool.IoC);Claypool.MVC={};(function($,$Log,$$MVC){$.manage("Claypool.MVC.Container","claypool:MVC");})(jQuery,Claypool,Claypool.MVC);(function($,$$,$$MVC){$$MVC.View$Interface={update:function(model){throw new $$.MethodNotImplementedError();},think:function(){throw new $$.MethodNotImplementedError();}};})(jQuery,Claypool,Claypool.MVC);(function($,$$,$$MVC){$$MVC.Controller=function(options){this.model=null;this.view=null;$$.extend(this,$$.SimpleCachingStrategy);$.extend(true,this,options);this.logger=$.logger("Claypool.MVC.Controller");};$.extend($$MVC.Controller.prototype,$$.SimpleCachingStrategy.prototype,{handle:function(event){throw new $$.MethodNotImplementedError();}});})(jQuery,Claypool,Claypool.MVC);(function($,$$,$$MVC){$$MVC.HijaxController=function(options){$$.extend(this,$$MVC.Controller);$.extend(true,this,{forwardingList:[],selector:"",filter:"",active:true,preventDefault:true,stopPropagation:true,hijaxMap:[],resolveQueue:[],strategy:null},options);this.router=new $$.Router();this.bindCache=new $$.SimpleCachingStrategy();this.logger=$.logger("Claypool.MVC.HijaxController");};$.extend($$MVC.HijaxController.prototype,$$MVC.Controller.prototype,{handle:function(data){this.logger.debug("Handling pattern: %s",data.pattern);this.forwardingList=this.router[this.strategy||"all"](data.pattern);this.logger.debug("Resolving matched paterns");var _this=this;return jQuery(this.forwardingList).each(function(){var target,action,defaultView;try{_this.logger.info("Forwaring to registered controller %s",this.payload.controller);target=$.$(this.payload.controller);defaultView=this.payload.controller.match('Controller')?this.payload.controller.replace('Controller','View'):null;defaultView=this.payload.controller.match('Service')?this.payload.controller.replace('Service','View'):defaultView;(function(t){var _event=data.args[0],extra=[],m={flash:[],length:0},v=defaultView,c=target;for(var i=1;i<data.args.length;i++){extra[i-1]=data.args[i];}var eventflow=$.extend({},_event,{m:function(){if(arguments.length===0){return m;}else if(arguments.length===1){if(typeof(arguments[0])=='string'){return m[arguments[0]];}else if(arguments[0]instanceof Array){m.length+=arguments[0].length;Array.prototype.push.apply(m,arguments[0]);}else if(arguments[0]instanceof Object){$.extend(true,m,arguments[0]);}}else if(arguments.length===2){if(arguments[1]instanceof Array){if(typeof(arguments[0])=='string'&&!(arguments[0]in m)){m[arguments[0]]=[];}$.merge(m[arguments[0]],arguments[1]);}else if(arguments[1]instanceof XML||arguments[1]instanceof XMLList){m[arguments[0]+'']=arguments[1];}else if(arguments[1]instanceof Object){if(typeof(arguments[0])=='string'&&!(arguments[0]in m)){m[arguments[0]]={};}$.extend(true,m[arguments[0]],arguments[1]);}}return this;},v:function(view){if(!view){return v;}if(view&&typeof(view)=='string'){view=view.split('.');if(view.length===1){v=view;}else if(view.length===2){if(view[0]!==""){v=view.join('.');}else{v=v.split('.')[0]+"."+view[1];}}}return this;},c:function(){var target,action,controller;if(arguments.length===0){return c;}else if(arguments.length>0&&typeof(arguments[0]=="string")){target=arguments[0].split(".");c=target[0];v=c.match('Controller')?c.replace('Controller','View'):null;v=c.match('Service')?c.replace('Service','View'):v;action=(target.length>0&&target[1].length>0)?target[1]:"handle";controller=_this.find(target[0]);if(controller===null){controller=$.$(target[0]);_this.add(target[0],controller);}controller[action](_event,extra);}return this;},render:_this.renderer(),reset:function(){m={flash:[],length:0};v=defaultView;c=target;return this;}});target[t.payload.action||"handle"].apply(target,[eventflow].concat(extra));})(this);}catch(e){e=e?e:new Error();if(e.name&&e.name.indexOf("Claypool.Application.ContextError")>-1){_this.logger.warn("No controller with id: %s",this.payload.controller);}else{_this.logger.exception(e);throw e;}}});},attach:function(){this.router.compile(this.hijaxMap,this.routerKeys);var _this=this;if(this.active&&(this.selector!==""||this.filter!=="")){this.logger.debug("Actively Hijaxing %s's.",this.hijaxKey);$(this.selector+this.filter).livequery(function(){_this.hijax(this);});}else if(this.selector!==""||this.filter!==""){this.logger.debug("Hijaxing Current %s's.",this.hijaxKey);$(this.selector+this.filter).each(function(){_this.hijax(this);});}else if(document!==undefined){this.logger.debug("Hijaxing Document For %s's.",this.hijaxKey);_this.hijax(document);}else{this.logger.warn("Unable to attach controller: %s",options.id);}},hijax:function(target){this.logger.debug("Hijaxing %s: %s",this.hijaxKey,target);var _this=this;var _hijax=function(event){var retVal=true;_this.logger.info("Hijaxing %s: ",_this.hijaxKey);if(_this.stopPropagation){_this.logger.debug("Stopping propogation of event");event.stopPropagation();}if(_this.preventDefault){_this.logger.debug("Preventing default event behaviour");event.preventDefault();retVal=false;}_this.handle({pattern:_this.target.apply(_this,arguments),args:arguments});return retVal;};if(this.event){$(target).bind(this.event+"."+this.eventNamespace,_hijax);_this.logger.debug("Binding event %s to hijax controller on target",this.event,target);}else{$(this.hijaxMap).each(function(){if(this.event&&!_this.bindCache.find(this.event)){_this.bindCache.add(this.event,_this);_this.logger.debug("Binding event %s to controller %s on target %s",this.event,this.controller,target);$(target).bind(this.event+"."+_this.eventNamespace,_hijax);}});}return true;},renderer:function(){var _this=this;var callbackStack=[];return function(callback){var target,controller,action,view,viewMethod,guidedEventRegistration;if(callback&&$.isFunction(callback)){callbackStack.push(callback);}_this.logger.debug(" - Resolving Control - %s)",this.c());try{view=this.v();viewMethod=$.isFunction(this.write)?"render":"update";if(view.indexOf(".")>-1){viewMethod=view.split('.');view=viewMethod[0];viewMethod=viewMethod[viewMethod.length-1];}_this.logger.debug("Calling View %s.%s",view,viewMethod);view=$.$(view);if(view){if($.isFunction(view[viewMethod])){if(this.write){view.write=this.write;view.append=this.append;view[viewMethod](this.m());}else{view[viewMethod](this.m());}_this.logger.debug("Cascading callbacks");while(callbackStack.length>0){(callbackStack.pop())();}}else if(view["@claypool:activeobject"]){guidedEventRegistration="claypool:postcreate:"+view["@claypool:id"]+"."+$.guid();$(document).bind(guidedEventRegistration,function(event,newView){_this.logger.warn("The view is reattached to the dom.");$(document).unbind(guidedEventRegistration);newView.update(this.m());_this.logger.debug("Cascading callbacks");while(callbackStack.length>0){(callbackStack.pop())();}});}else{_this.logger.debug("View method cannot be resolve",viewMethod);}}else{_this.logger.warn("Cant resolve view %s. ",this.v());}}catch(e){_this.logger.error("Error resolving flow %s => %s",this.c(),this.v()).exception(e);throw e;}return _this;};},target:function(event){throw new $$.MethodNotImplementedError();}});})(jQuery,Claypool,Claypool.MVC);(function($,$$,$$MVC){$$MVC.Factory=function(options){$$.extend(this,$$.IoC.Factory);$.extend(true,this,options);this.configurationId='mvc';this.logger=$.logger("Claypool.MVC.Factory");};$.extend($$MVC.Factory.prototype,$$.IoC.Factory.prototype,{updateConfig:function(){var mvcConfig;try{this.logger.debug("Configuring Claypool MVC Controller Factory");mvcConfig=this.getConfig()||{};$(document).trigger("claypool:hijax",[this,this.initializeHijaxController,mvcConfig]);}catch(e){this.logger.exception(e);throw new $$MVC.ConfigurationError(e);}},scan:function(name){var log=this.logger||$.logger("Claypool.MVC.Factory");log.debug("Scanning %s",name);var prop,scanBase,configsByConvention=[],idNamingConvention=function(localName,type){return("#"+localName.substring(0,1).toLowerCase()+localName.substring(1)+type);},domNamingConvention=function(localName){return("#"+localName.substring(0,1).toLowerCase()+localName.substring(1));};try{scanBase=$.resolve(name);for(prop in scanBase){log.debug("Scan Checking %s.%s",name,prop);if($.isFunction(scanBase[prop])){log.debug("Found Function Definition on %s.%s",name,prop);if(name.match(".Models")){log.debug("Configuring by Convention %s.%s",name,prop);configsByConvention.push({id:idNamingConvention(prop,"Model"),clazz:name+"."+prop});}else if(name.match(".Views")){log.debug("Configuring by Convention %s.%s",name,prop);configsByConvention.push({id:idNamingConvention(prop,"View"),clazz:name+"."+prop,selector:domNamingConvention(prop)});}else if(name.match(".Controllers")){log.debug("Configuring by Convention %s.%s",name,prop);configsByConvention.push({id:idNamingConvention(prop,"Controller"),clazz:name+"."+prop});}else if(name.match(".Services")){log.debug("Configuring by Convention %s.%s",name,prop);configsByConvention.push({id:idNamingConvention(prop,"Service"),clazz:name+"."+prop});}}}}catch(e){log.error("Error Scanning %s!!",name).exception(e);}return configsByConvention;},initializeHijaxController:function(mvcConfig,key,clazz,options){var configuration;var i;if(mvcConfig[key]){for(i=0;i<mvcConfig[key].length;i++){configuration={};configuration.id=mvcConfig[key][i].id;configuration.clazz=clazz;configuration.options=[$.extend(true,options||{},mvcConfig[key][i])];this.logger.debug("Adding MVC Configuration for Controller Id: %s",configuration.id);this.add(configuration.id,configuration);}}}});})(jQuery,Claypool,Claypool.MVC);(function($,$$,$$MVC){$$MVC.Container=function(options){$$.extend(this,$$.Application.ContextContributor);$.extend(true,this,options);this.factory=null;this.logger=$.logger("Claypool.MVC.Container").debug("Configuring Claypool MVC Container");this.factory=new $$MVC.Factory();this.factory.updateConfig();var controller,id;for(id in this.factory.cache){controller=this.get(id);this.logger.debug("attaching mvc core controller: %s",id);controller.attach();}};$.extend($$MVC.Container.prototype,$$.Application.ContextContributor.prototype,{get:function(id){var controller;try{this.logger.debug("Search for a container managed controller : %s",id);controller=this.find(id);if(controller===undefined||controller===null){this.logger.debug("Can't find a container managed controller : %s",id);controller=this.factory.create(id);if(controller!==null){this.add(id,controller);return controller._this;}else{return null;}}else{this.logger.debug("Found container managed controller : %s",id);return controller._this;}}catch(e){this.logger.exception(e);throw new $$MVC.ContainerError();}throw new $$MVC.FactoryError(id);}});})(jQuery,Claypool,Claypool.MVC);(function($,$$,$$MVC){$$MVC.ContainerError=function(e){$.extend(this,new $$.Error(e,{name:"Claypool.MVC.ContainerError",message:"An error occurred trying to retreive a container managed object."}));};})(jQuery,Claypool,Claypool.MVC);(function($,$$,$$MVC){$$MVC.FactoryError=function(e){$.extend(this,new $$.Error(e,{name:"Claypool.MVC.FactoryError",message:"An error occured trying to create the factory object."}));};})(jQuery,Claypool,Claypool.MVC);(function($,$$,$$MVC){$$MVC.ConfigurationError=function(e){$.extend(this,new $$.ConfigurationError(e,{name:"Claypool.MVC.ConfigurationError",message:"An error occured during the configuration."}));};})(jQuery,Claypool,Claypool.MVC);(function($,$$,$$MVC){$.extend($,{router:function(confId,options){$(document).bind("claypool:hijax",function(event,_this,registrationFunction,configuration){registrationFunction.apply(_this,[configuration,confId,"Claypool.MVC.HijaxController",options]);});return this;}});$.router("hijax:a",{selector:'a',event:'click',strategy:'first',routerKeys:'urls',hijaxKey:'link',eventNamespace:"Claypool:MVC:HijaxLinkController",target:function(event){var link=event.target||event.currentTarget;while(link.tagName.toUpperCase()!='A'){link=$(link).parent()[0];}return $(link).attr("href");}}).router("hijax:button",{selector:':button',event:'click',strategy:'all',routerKeys:'urls',hijaxKey:'button',eventNamespace:"Claypool:MVC:HijaxButtonController",target:function(event){return event.target.value;}}).router("hijax:input",{selector:'input',event:'blur',strategy:'all',routerKeys:'names',hijaxKey:'input',eventNamespace:"Claypool:MVC:HijaxInputController",target:function(event){return event.target.value;}}).router("hijax:form",{selector:'form',event:'submit',strategy:'first',routerKeys:'urls',hijaxKey:'form',eventNamespace:"Claypool:MVC:HijaxFormController",target:function(event){return event.target.action;}}).router("hijax:event",{strategy:'all',routerKeys:'event',hijaxKey:'event',eventNamespace:"Claypool:MVC:HijaxEventController",target:function(event){return event.type;}});$.mvc_scanner=$$MVC.Factory.prototype;})(jQuery,Claypool,Claypool.MVC);Claypool.Server={};(function($,$$,$$Web){$.router("hijax:server",{event:'claypool:serve',strategy:'first',routerKeys:'urls',hijaxKey:'request',eventNamespace:"Claypool:Server:HijaxServerController",target:function(event,request){return request.url;}});})(jQuery,Claypool,Claypool.Server);(function($,$$,$$Web){$$Web.Servlet=function(options){$$.extend(this,$$.MVC.Controller);$.extend(true,this,options);this.logger=$.logger("Claypool.Server.Servlet");};$.extend($$Web.Servlet.prototype,$$.MVC.Controller.prototype,{handle:function(event,data,request,response){response=$.extend(true,response,event,{write:function(str){response.body=str;return this;},append:function(str){response.body+=str;return this;}});try{switch(request.method.toUpperCase()){case'GET':this.logger.debug("Handling GET request");this.handleGet(request,response);this.logger.debug("Finished Handling GET request. Setting status 200.");response.headers.status=200;break;case'POST':this.logger.debug("Handling POST request");this.handlePost(request,response);break;case'PUT':this.logger.debug("Handling PUT request");this.handlePut(request,response);break;case'DELETE':this.logger.debug("Handling DELETE request");this.handleDelete(request,response);break;case'HEAD':this.logger.debug("Handling HEAD request");this.handleHead(request,response);break;case'OPTIONS':this.logger.debug("Handling OPTIONS request");this.handleOptions(request,response);break;default:this.logger.debug("Unknown Method: %s, rendering error response.",request.method);this.handleError(request,response,"Unknown Method: "+request.method);}}catch(e){this.logger.exception(e);this.handleError(request,response,"Caught Exception in Servlet handler",e);}},handleGet:function(request,response){throw new $$.MethodNotImplementedError();},handlePost:function(request,response){throw new $$.MethodNotImplementedError();},handlePut:function(request,response){throw new $$.MethodNotImplementedError();},handleDelete:function(request,response){throw new $$.MethodNotImplementedError();},handleHead:function(request,response){throw new $$.MethodNotImplementedError();},handleOptions:function(request,response){throw new $$.MethodNotImplementedError();},handleError:function(request,response,msg,e){this.logger.warn("The default error response should be overriden");response.headers.status=300;response.body=msg?msg:"Unknown internal error\n";response.body+=e&&e.msg?e.msg:(e?e:"\nUnpsecified Error.");},resolve:function(data){this.logger.warn("The default resolve response is meant to be overriden to allow the rendering of a custom view.");return data.response;}});})(jQuery,Claypool,Claypool.Server);(function($,$$,$$Web){$$Web.ReSTScaffold=function(options){$$.extend(this,$$Web.Servlet);$.extend(true,this,options);this.logger=$.logger("Claypool.Server.ReSTScaffold");this.Model=$.$(options.model);};$.extend($$Web.ReSTScaffold.prototype,$$Web.Servlet.prototype,{handleGet:function(request,response){var instance,id$format,_this=this,p=request.requestURL;if(p){id$format=p.match(/(\d+)\.(\w+)$/);if(id$format){this.logger.debug("Getting Instance %",id$format[1]);instance=new this.Model(Number(id$format[1]));response.body=this.Model.serialize(instance,id$format[2]);response.headers["Content-Type"]="text/"+id$format[2];}else{id$format=p.match(/(\w+)$/);if(id$format){p.replace(/(\w+)$/,function(url,action){_this.logger.debug("using custom action : %s",action);if($.isFunction(_this[action])){_this[action](request,response);}return action;});return response;}else{this.search(request,response);}}this.chooseView(request,response);}return response;},search:function(request,response){this.logger.debug("Searching for records.");var searchTerms=request.parameters.searchTerms||'*',itemsPerPage=Number(request.parameters.itemsPerPage||40),startIndex=Number(request.parameters.startIndex||0),offsetIndex=Number(request.parameters.offsetIndex||0),startPage=Number(request.parameters.startPage||0),language="en-US",inputEncoding="utf-8",outputEncoding="utf-8",results=[],filter,i;for(var param in request.parameters){this.logger.debug("checking for filter % ",param);for(i=0;i<this.Model._meta.fields.length;i++){if(this.Model._meta.fields[i].fieldName==param){this.logger.debug("adding filter % = ? (%)",param,request.parameters[param]);filter=filter?filter.filter(param+" = ?",request.parameters[param]):this.Model.filter(param+" = ?",request.parameters[param]);}}}filter=filter?filter:this.Model.all();if(searchTerms=="*"){results=filter.limit(itemsPerPage).offset((startPage*itemsPerPage)+offsetIndex+startIndex).toArray();for(i=0;i<results.length;i++){results[i]=this.Model.serialize(results[i]);}this.logger.debug("Found %s results from search.",results.length);response.m({xmlns$opensearch:"http://a9.com/-/spec/opensearch/1.1/",searchTerms:searchTerms,startPage:startPage,totalResults:results.length,startIndex:startIndex,itemsPerPage:itemsPerPage,results:results});}},handlePost:function(request,response){var instance,newuser,id$format,p=request.requestURL,_this=this;this.logger.debug("ReSTService POST: \n%s",request.body);if(p){if(p.match(/(\d+)\.(\w+)$/)){id$format=p.match(/(\d+)\.(\w+)$/);this.logger.debug("Updating Instance %",id$format[1]);instance=this.Model(Number(id$format[1]));newinstance=this.Model.deserialize(request.body,id$format[2]);newinstance=new this.Model(newinstance);newinstance.setPkValue(instance.getPkValue());this.Model.transaction(function(){instance.remove();newinstance.save();});response.body=newinstance.getPkValue();response.headers.status=200;response.headers["Content-Type"]="text/plain";}else if(p.match(/(new)\.(\w+)$/)){id$format=p.match(/(new)\.(\w+)$/);this.logger.debug("Saving New Instance (formatted as %s) \n%s ",id$format[2],request.body);newinstance=this.Model.deserialize(request.body,id$format[2]);newinstance=new this.Model(newinstance);this.logger.debug("Deserialized new instance %s ",newinstance);newinstance.save();response.body=newinstance.getPkValue();response.headers.status=200;response.headers["Content-Type"]="text/plain";}else if(p.match(/search$/)){this.search(request,response);this.chooseView(request,response);}else{p.replace(/(\w+)$/,function(url,action){_this.logger.debug("using custom action : %s",action);if($.isFunction(_this[action])){_this[action](request,response);}return action;});}}this.logger.debug("POST RESPONSE \n %s",response.body);return response;},handleDelete:function(request,response){var instance,id$format,p=request.requestURL;if(p){id$format=p.match(/(\d+)\.(\w+)$/);if(id$format){this.logger.debug("Deleting Instance %",id$format[1]);instance=this.Model.find(id$format[1]);instance.remove();response.body="";response.headers.status=200;response.headers["Content-Type"]="text/plain";}}return response;},chooseView:function(request,response){var p=request.requestURL;if(p.match(/atom$/)){response.headers.status=200;response.headers["Content-Type"]="application/atom+xml";response.v('.atom');}else if(p.match(/xml$/)){response.headers.status=200;response.headers["Content-Type"]="text/xml";response.v('.xml');}else if(p.match(/xhtml$/)){response.headers.status=200;response.headers["Content-Type"]="text/html";response.v('.xhtml');}else{response.headers.status=200;response.headers["Content-Type"]="text/json";response.v('.json');}response.render();}});})(jQuery,Claypool,Claypool.Server);(function($,$$,$$Web){$$Web.WebProxyServlet=function(options){$$.extend(this,$$Web.Servlet);this.rewriteMap=null;$.extend(true,this,options);this.logger=$.logger("Claypool.Server.WebProxyServlet");this.router=new $$.Router();this.strategy=this.strategy||"first";this.logger.debug("Compiling url rewrites %s.",this.rewriteMap);this.router.compile(this.rewriteMap,"urls");};$.extend($$Web.WebProxyServlet.prototype,$$Web.Servlet.prototype,{handleGet:function(request,response){this.logger.debug("Handling proxy: %s",request.requestURI);var _this=this;var proxyURL=this.router[this.strategy||"all"](request.requestURI);request.headers["Claypool-Proxy"]=this.proxyHost||"127.0.0.1";var params={};for(var prop in request.parameters){this.logger.debug("request.parameters[%s]=%s",prop,request.parameters[prop]);params[prop+'']=request.parameters[prop]+'';}if(proxyURL&&proxyURL.length&&proxyURL.length>0){_this.logger.debug("Proxying get request to: %s",proxyURL[0].payload.rewrite);$.ajax({type:"GET",dataType:"text",async:false,data:params,url:proxyURL[0].payload.rewrite+'',beforeSend:function(xhr){_this.logger.debug("Copying Request headers for Proxied Request");for(var header in request.headers){_this.logger.debug("Setting proxied request header %s: %s",header,request.headers[header]);if(header=='host'){continue;}xhr.setRequestHeader(header,request.headers[header]);}response.headers={};},success:function(text){_this.logger.debug("Got response for proxy.");response.body=text;_this.logger.debug("Setting Response Status 200.");response.headers.status=200;},error:function(xhr,status,e){_this.logger.error("Error proxying request. STATUS: %s",status?status:"UNKNOWN");if(e){_this.logger.exception(e);}response.headers.status=500;},complete:function(xhr,status){_this.logger.debug("Proxy Request Complete, Copying response headers");var proxyResponseHeaders=xhr.getAllResponseHeaders();var responseHeader;var responseHeaderMap;_this.logger.debug("Complete Proxy response header: \n %s",proxyResponseHeaders);proxyResponseHeaders=proxyResponseHeaders.split("\r\n");for(var i=0;i<proxyResponseHeaders.length;i++){responseHeaderMap=proxyResponseHeaders[i].split(":");try{_this.logger.debug("setting response header %s %s",responseHeaderMap[0],responseHeaderMap.join(":"));response.headers[responseHeaderMap.shift()]=responseHeaderMap.join(":");}catch(e){_this.logger.warn("Unable to set a proxied response header");_this.logger.exception(e);}}response.headers["Claypool-Proxy"]=proxyURL[0].payload.rewrite;response.headers["Content-Encoding"]=proxyURL[0].payload.contentEncoding||"";if(proxyURL[0].payload.contentType){response.headers["Content-Type"]=proxyURL[0].payload.contentType;}}});}return response;}});})(jQuery,Claypool,Claypool.Server);(function($,$$,$$Web){$$Web.E4XServlet=function(options){$$.extend(this,$$Web.Servlet);$.extend(true,this,options);this.logger=$.logger("Claypool.Server.E4XServlet");};$.extend($$Web.E4XServlet.prototype,$$Web.Servlet.prototype,{handleGet:function(request,response){var _this=this;if(!typeof(response.m('postparams'))=="string"){if($.isFunction($.js2json)){response.m("postparams",$.js2json(request.parameters));}else{response.m("postparams","{}");}}try{this.logger.info("Loading E4X from url :\n%s",request.requestURI);$.ajax({type:'GET',url:(this.baseURI||"./")+request.requestURI,dataType:"text/plain",async:false,success:function(text){_this.logger.info("Successfully retreived E4X :\n%s \n Evaluating with model %s",request.requestURI,response.m("postparams"));var e4x=eval("(function(){"+"var model = "+response.m("postparams")+";"+"return new XMLList(<>"+text+"</>);"+"})();");response.body=e4x.toString();response.headers["Content-Type"]="text/html";response.headers.status=200;_this.logger.info("Finished Evaluating E4X :\n%s",request.requestURI);},error:function(xhr,status,e){_this.logger.info("Error retreiving E4X :\n%s",request.requestURI);response.body="<html><head></head><body>"+e||"Unknown Error"+"</body></html>";response.headers["Content-Type"]="text/html";response.headers.status=200;}});}catch(e){this.logger.error("Error evaluating. \n\n%s",request.requestURI).exception(e);response.body=e.toString();}return response;},handlePost:function(request,response){response.m("postparams",String(request.body));return this.handleGet(request,response);}});})(jQuery,Claypool,Claypool.Server);(function($,$$,$$Web){$$Web.ConsoleServlet=function(options){$$.extend(this,$$Web.Servlet);$.extend(true,this,options);this.logger=$.logger("Claypool.Server.ConsoleServlet");};$.extend($$Web.ConsoleServlet.prototype,$$Web.Servlet.prototype,{handlePost:function(request,response){var retval="ok";try{this.logger.info("Executing command :\n%s",request.body);retval=eval(String(request.body));retval=(retval===undefined)?"ok":retval;this.logger.info("Finished Executing command :\n%s",request.body);response.body=retval||"error: see server logs.";}catch(e){this.logger.error("Error executing command. \n\n%s",request.body).exception(e);response.body=e.toString();}response.body=retval;response.headers["Content-Type"]="text/plain";response.headers.status=200;return response;}});})(jQuery,Claypool,Claypool.Server);(function($,$$,$$Web){$$Web.Console=function(options){$.extend(true,this,options);this.logger=$.logger("Claypool.Server.Console");};$.extend($$Web.Console.prototype,{run:function(command){var _this=this;$.ajax({type:'POST',url:'console/',processData:false,contentType:'text',data:command,success:function(response){_this.logger.info(response);},error:function(xhr,status,e){_this.logger.error("Error sending command (%s)",s).exception(e);}});}});})(jQuery,Claypool,Claypool.Server);(function($,$$,$$Web){})(jQuery,Claypool,Claypool.Server);(function($,$$,$$Web){var $log;var console;$.extend($,{_:function(command){console=console||new $$Web.Console();console.run(command);},serve:function(request,response){$log=$log||$.logger("Claypool.Server");$log.info("Handling global request routing for request: %s ",request.requestURL).debug("Dispatching request to Server Sevlet Container");response.headers={};$.extend(response.headers,{contentType:'text/html',status:404});response.body="<html><head></head><body>"+"Not Found :\n\t"+request.requestURL+"</body></html>";try{$(document).trigger("claypool:serve",[{url:request.requestURL},request,response]);}catch(e){$log.error("Error Handling Request.").exception(e);response.headers["Content-Type"]="text/html";response.headers.status=500;response.body="<html><head></head><body>"+e||"Unknown Error"+"</body></html>";}}});ClaypoolServerHandler=$.serve;})(jQuery,Claypool,Claypool.Server);