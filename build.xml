<?xml version="1.0" encoding="UTF-8"?>
<!-- You may freely edit this file. See commented blocks below for -->
<!-- some examples of how to customize the build. -->
<!-- (If you delete it and reopen the project it will be recreated.) -->
<project name="Claypool" default="default" basedir=".">
    <description>Builds, tests, and runs the project Claypool.</description>
    
    <property name="JQUERY_LIB" location="../../../jQuery/trunk/"/><!-- test 39 />--> 
    
    <property description="Java Jars" name="JAVA_LIB_DIR" location="WEB-INF/lib" />
    <property description="Rhino JS Engine" name="RHINO_JAR" location="${JAVA_LIB_DIR}/js.jar" />
    <property description="JSLint Syntax Checking Engine" name="JSLINT_JAR" location="${JAVA_LIB_DIR}/jslint4java-1.1.jar" />
    <property description="Javax Servlet API" name="SERVLET_JAR" location="../../lib/servlet-api.jar" />
    <property description="Log4j Logging API" name="LOG4J_JAR" location="${JAVA_LIB_DIR}/log4j-1.2.15.jar" />

    <property name="PREFIX"         location="${basedir}/"                  description="Target parent folder for built files"   />
    <property name="SRC_DIR"        location="${PREFIX}/src"                description="Folder for source files"  />
    <property name="DOCS_DIR"       location="${PREFIX}/docs"               description="Folder for docs target"  />
    <property name="TEST_DIR"       location="${PREFIX}/test"               description="Folder for test target"  />
    <property name="DIST_DIR"       location="${PREFIX}/dist"               description="Folder for jquery, min, lite and packed target" />
    <property name="TOOLS_DIR"      location="${PREFIX}/tools"              description="Files for parsing etc."/>
    <property name="LIB_DIR"        location="${PREFIX}/lib"                description="Folder for jQuery and additional third party js libraries" />
    <property name="CLASSES_DIR"    location="${basedir}/WEB-INF/classes"   description="Local Classes like Servlets"  />

    <!-- Files names for distribution -->
    <property name="CLAYPOOL_CORE"   			location="${DIST_DIR}/jquery.claypool.core.js" />
    <property name="CLAYPOOL_CORE_MIN"  		location="${DIST_DIR}/jquery.claypool.core.min.js" />
    <property name="CLAYPOOL_LOGGING"   		location="${DIST_DIR}/jquery.claypool.logging.js" />
    <property name="CLAYPOOL_LOGGING_MIN"   	location="${DIST_DIR}/jquery.claypool.logging.min.js" />
    <property name="CLAYPOOL_APPLICATION"   	location="${DIST_DIR}/jquery.claypool.application.js" />
    <property name="CLAYPOOL_APPLICATION_MIN"	location="${DIST_DIR}/jquery.claypool.application.min.js" />
    <property name="CLAYPOOL_IOC"   			location="${DIST_DIR}/jquery.claypool.ioc.js" />
    <property name="CLAYPOOL_IOC_MIN"   		location="${DIST_DIR}/jquery.claypool.ioc.min.js" />
    <property name="CLAYPOOL_MVC"   			location="${DIST_DIR}/jquery.claypool.mvc.js" />
    <property name="CLAYPOOL_MVC_MIN"   		location="${DIST_DIR}/jquery.claypool.mvc.min.js" />
    <property name="CLAYPOOL_AOP"   			location="${DIST_DIR}/jquery.claypool.aop.js" />
    <property name="CLAYPOOL_AOP_MIN"   		location="${DIST_DIR}/jquery.claypool.aop.min.js" />
    <property name="CLAYPOOL_SERVER"   			location="${DIST_DIR}/jquery.claypool.server.js" />
    <property name="CLAYPOOL_SERVER_MIN"   		location="${DIST_DIR}/jquery.claypool.server.min.js" />
    <property name="CLAYPOOL_DATA"   			location="${DIST_DIR}/jquery.claypool.data.js" />
    <property name="CLAYPOOL_DATA_MIN"   		location="${DIST_DIR}/jquery.claypool.data.min.js" />
    <property name="CLAYPOOL_DAO"   			location="${DIST_DIR}/jquery.claypool.dao.js" />
    <property name="CLAYPOOL_DAO_MIN"   		location="${DIST_DIR}/jquery.claypool.dao.min.js" />
    <property name="CLAYPOOL_TEMPLATE"   		location="${DIST_DIR}/jquery.claypool.template.js" />
    <property name="CLAYPOOL_TEMPLATE_MIN"   	location="${DIST_DIR}/jquery.claypool.template.min.js" />
    <property name="CLAYPOOL_TEST"   			location="${DIST_DIR}/jquery.claypool.test.js" />
    <property name="CLAYPOOL_TEST_MIN"   		location="${DIST_DIR}/jquery.claypool.test.min.js" />
    <property name="CLAYPOOL_ALL"   			location="${DIST_DIR}/jquery.claypool.all.js" />
    <property name="CLAYPOOL_ALL_MIN"   		location="${DIST_DIR}/jquery.claypool.all.min.js" />
    
    <!-- Plugin File Names for Distribution -->
    
    <!-- BUILD TARGETS -->
    <target name="default" depends="lint, min, compile"/>
    
    <target name="all" depends="default"/>
    
    <target name="support">
       <copy todir="${LIB_DIR}">
           <fileset dir="${JQUERY_LIB}/">
               <include name="jquery/src/*.js"/>
               <include name="jquery/dist/*.js"/>
               <include name="jquery/**/*.json"/>
               <include name="ui/current/*.js"/>
               <include name="ui/experimental/*.js"/>
               <include name="ui/**/*.json"/>
               <include name="fx/current/*.js"/>
               <include name="fx/experimental/*.js"/>
               <include name="fx/**/*.json"/>
               <include name="plugins/dimensions/jquery.dimensions*.js"/>
               <include name="plugins/livequery/jquery.livequery*.js"/>
               <include name="plugins/form/form/jquery.form*.js"/>
               <include name="themes/"/>
           </fileset>
       </copy>
        <delete failonerror="false" quiet="true">
            <fileset dir="${CLASSES_DIR}">
                <include name="**/*"/>
            </fileset>
        </delete>
        <delete failonerror="false" quiet="true">
            <fileset dir="${CLASSES_DIR}">
                <include name="**/*"/>
            </fileset>
        </delete>
    </target>
    
    <target name="lint" depends="concat">
        <java jar="${JSLINT_JAR}" classpath="${RHINO_JAR}" fork="true">
            <arg value="${CLAYPOOL_CORE}" />
        </java>
        <java jar="${JSLINT_JAR}" classpath="${RHINO_JAR}" fork="true">
            <arg value="${CLAYPOOL_LOGGING}" />
        </java>
        <java jar="${JSLINT_JAR}" classpath="${RHINO_JAR}" fork="true">
            <arg value="${CLAYPOOL_APPLICATION}" />
        </java>
        <java jar="${JSLINT_JAR}" classpath="${RHINO_JAR}" fork="true">
            <arg value="${CLAYPOOL_IOC}" />
        </java>
        <java jar="${JSLINT_JAR}" classpath="${RHINO_JAR}" fork="true">
            <arg value="${CLAYPOOL_MVC}" />
        </java>
        <java jar="${JSLINT_JAR}" classpath="${RHINO_JAR}" fork="true">
            <arg value="${CLAYPOOL_AOP}" />
        </java>
        <java jar="${JSLINT_JAR}" classpath="${RHINO_JAR}" fork="true">
            <arg value="${CLAYPOOL_SERVER}" />
        </java>
        <java jar="${JSLINT_JAR}" classpath="${RHINO_JAR}" fork="true">
            <arg value="${CLAYPOOL_DATA}" />
        </java>
        <java jar="${JSLINT_JAR}" classpath="${RHINO_JAR}" fork="true">
            <arg value="${CLAYPOOL_DAO}" />
        </java>
        <java jar="${JSLINT_JAR}" classpath="${RHINO_JAR}" fork="true">
            <arg value="${CLAYPOOL_TEMPLATE}" />
        </java>
        <java jar="${JSLINT_JAR}" classpath="${RHINO_JAR}" fork="true">
            <arg value="${CLAYPOOL_TEST}" />
        </java>
        <java jar="${JSLINT_JAR}" classpath="${RHINO_JAR}" fork="true">
            <arg value="${CLAYPOOL_ALL}" />
        </java>
    </target>
    
    <target name="compile">
        <javac srcdir="${CLASSES_DIR}" source="1.5" target="1.5">
            <classpath>
                <path location="${RHINO_JAR}"/>
                <path location="${SERVLET_JAR}"/>
                <path location="${LOG4J_JAR}"/>
            </classpath>
        </javac>
    </target>
    
    <target name="clean">
        <delete  dir="${LIB_DIR}/jquery"/>
        <delete  dir="${LIB_DIR}/ui"/>
        <delete  dir="${LIB_DIR}/fx"/>
        <delete  dir="${LIB_DIR}/plugins"/>
        <delete  dir="${LIB_DIR}/themes"/>
        <delete dir="${DOCS_DIR}" />
        <delete dir="${DIST_DIR}" />
    </target>
    
    <target name="concat" description="Main claypool build">
    	<!-- CORE -->
        <echo message="Building ${CLAYPOOL_CORE}" />
        <mkdir dir="${DIST_DIR}" />
        <concat destfile="${CLAYPOOL_CORE}">
            <fileset dir="${SRC_DIR}" includes="claypool.core.js" />
        </concat>
        <echo message="${CLAYPOOL_CORE} built." />
        
    	<!-- LOGGING -->
        <echo message="Building ${CLAYPOOL_LOGGING}" />
        <mkdir dir="${DIST_DIR}" />
        <concat destfile="${CLAYPOOL_LOGGING}">
            <fileset dir="${SRC_DIR}" includes="claypool.logging.js" />
        </concat>
        <echo message="${CLAYPOOL_LOGGING} built." />
        
    	<!-- APPLICATION -->
        <echo message="Building ${CLAYPOOL_APPLICATION}" />
        <mkdir dir="${DIST_DIR}" />
        <concat destfile="${CLAYPOOL_APPLICATION}">
            <fileset dir="${SRC_DIR}" includes="claypool.application.js" />
        </concat>
        <echo message="${CLAYPOOL_APPLICATION} built." />
        
    	<!-- IOC -->
        <echo message="Building ${CLAYPOOL_IOC}" />
        <mkdir dir="${DIST_DIR}" />
        <concat destfile="${CLAYPOOL_IOC}">
            <fileset dir="${SRC_DIR}" includes="claypool.ioc.js" />
        </concat>
        <echo message="${CLAYPOOL_IOC} built." />
        
    	<!-- MVC -->
        <echo message="Building ${CLAYPOOL_MVC}" />
        <mkdir dir="${DIST_DIR}" />
        <concat destfile="${CLAYPOOL_MVC}">
            <fileset dir="${SRC_DIR}" includes="claypool.mvc.js" />
        </concat>
        <echo message="${CLAYPOOL_MVC} built." />
        
    	<!-- AOP -->
        <echo message="Building ${CLAYPOOL_AOP}" />
        <mkdir dir="${DIST_DIR}" />
        <concat destfile="${CLAYPOOL_AOP}">
            <fileset dir="${SRC_DIR}" includes="claypool.aop.js" />
        </concat>
        <echo message="${CLAYPOOL_AOP} built." />
        
    	<!-- SERVER -->
        <echo message="Building ${CLAYPOOL_SERVER}" />
        <mkdir dir="${DIST_DIR}" />
        <concat destfile="${CLAYPOOL_SERVER}">
            <fileset dir="${SRC_DIR}" includes="claypool.server.js" />
        </concat>
        <echo message="${CLAYPOOL_SERVER} built." />
        
    	<!-- DATA -->
        <echo message="Building ${CLAYPOOL_DATA}" />
        <mkdir dir="${DIST_DIR}" />
        <concat destfile="${CLAYPOOL_DATA}">
            <fileset dir="${SRC_DIR}" includes="claypool.data.js" />
        </concat>
        <echo message="${CLAYPOOL_DATA} built." />
        
    	<!-- DAO -->
        <echo message="Building ${CLAYPOOL_DAO}" />
        <mkdir dir="${DIST_DIR}" />
        <concat destfile="${CLAYPOOL_DAO}">
            <fileset dir="${SRC_DIR}" includes="claypool.dao.js" />
        </concat>
        <echo message="${CLAYPOOL_DAO} built." />
        
    	<!-- BINDING -->
        <echo message="Building ${CLAYPOOL_TEMPLATE}" />
        <mkdir dir="${DIST_DIR}" />
        <concat destfile="${CLAYPOOL_TEMPLATE}">
            <fileset dir="${SRC_DIR}" includes="claypool.template.js" />
        </concat>
        <echo message="${CLAYPOOL_TEMPLATE} built." />
        
    	<!-- TEST (MoonUnit)-->
        <echo message="Building ${CLAYPOOL_TEST}" />
        <mkdir dir="${DIST_DIR}" />
        <concat destfile="${CLAYPOOL_TEST}">
            <fileset dir="${SRC_DIR}" includes="claypool.test.js" />
        </concat>
        <echo message="${CLAYPOOL_TEST} built." />
        
    	<!-- ALL -->
        <echo message="Building ${CLAYPOOL_ALL}" />
        <mkdir dir="${DIST_DIR}" />
        <concat destfile="${CLAYPOOL_ALL}">
            <fileset dir="${SRC_DIR}" includes="claypool.core.js" />
            <fileset dir="${SRC_DIR}" includes="claypool.logging.js" />
            <fileset dir="${SRC_DIR}" includes="claypool.application.js" />
            <fileset dir="${SRC_DIR}" includes="claypool.aop.js" />
            <fileset dir="${SRC_DIR}" includes="claypool.ioc.js" />
            <fileset dir="${SRC_DIR}" includes="claypool.mvc.js" />
            <fileset dir="${SRC_DIR}" includes="claypool.server.js" />
            <fileset dir="${SRC_DIR}" includes="claypool.data.js" />
            <fileset dir="${SRC_DIR}" includes="claypool.dao.js" />
            <!--fileset dir="${SRC_DIR}" includes="claypool.binding.js" /-->
        </concat>
        <echo message="${CLAYPOOL_ALL} built." />
    </target>

    <target name="min" depends="concat" description="Remove all comments and whitespace, no compression">
        <echo message="Building ${CLAYPOOL_ALL_MIN}" />
        <java jar="${RHINO_JAR}" fork="true">
            <arg value="${TOOLS_DIR}/build/min.js" />
            <arg value="${CLAYPOOL_ALL}" />
            <arg value="${CLAYPOOL_ALL_MIN}" />
        </java>
        <echo message="${CLAYPOOL_ALL_MIN} built." />
    </target>

    <target name="runtest">
		<echo message="Running Automated Test Suite" />
		<java classname="org.mozilla.javascript.tools.shell.Main" fork="true">
            <arg value="${TOOLS_DIR}/runtest/test.js" />
            <classpath>
                <pathelement path="${CLASSES_DIR}"/>
                <pathelement location="${RHINO_JAR}"/>
            </classpath>
        </java>
		<echo message="Test Suite Finished" />
	</target>
</project>
